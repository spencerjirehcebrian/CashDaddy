{"level":"info","message":"Connected to MongoDB: mongodb://localhost:27017/cashdaddy_user_dev","service":"shared","timestamp":"2024-08-26 12:25:38"}
{"level":"info","message":"Connected to Redis: redis://localhost:6379","service":"shared","timestamp":"2024-08-26 12:25:38"}
{"level":"info","message":"Connected to Kafka: localhost:29092","service":"shared","timestamp":"2024-08-26 12:25:38"}
{"level":"info","message":"CacheManager initialized with CacheService.","service":"shared","timestamp":"2024-08-26 12:25:38"}
{"level":"info","message":"Connected Kafka Consumer","service":"shared","timestamp":"2024-08-26 12:25:38"}
{"level":"info","message":"KYC microservice listening on port 3003","service":"shared","timestamp":"2024-08-26 12:25:41"}
{"level":"info","message":"Connected to MongoDB: mongodb://localhost:27017/cashdaddy_user_dev","service":"shared","timestamp":"2024-08-26 12:51:47"}
{"level":"info","message":"Connected to Redis: redis://localhost:6379","service":"shared","timestamp":"2024-08-26 12:51:47"}
{"level":"info","message":"Connected to Kafka: localhost:29092","service":"shared","timestamp":"2024-08-26 12:51:47"}
{"level":"info","message":"CacheManager initialized with CacheService.","service":"shared","timestamp":"2024-08-26 12:51:47"}
{"level":"info","message":"Connected Kafka Consumer","service":"shared","timestamp":"2024-08-26 12:51:47"}
{"level":"info","message":"Payment microservice listening on port 3003","service":"shared","timestamp":"2024-08-26 12:51:50"}
{"level":"info","message":"Received message:","offset":"0","partition":0,"service":"shared","timestamp":"2024-08-26 12:55:09","topic":"payment-events","value":"{\"action\":\"getPaymentMethod\",\"payload\":{\"_id\":\"66cb33624864f12a5b94bacd\",\"user\":\"66c94fd65cb63642498b6445\",\"balance\":970,\"currency\":\"USD\",\"stripeCustomerId\":\"cus_Qj8uGWvXpd7d0p\",\"createdAt\":\"2024-08-25T13:36:34.181Z\",\"updatedAt\":\"2024-08-25T13:37:40.905Z\"}}"}
{"level":"info","message":"Handling getPaymentMethods event for user: undefined","service":"shared","timestamp":"2024-08-26 12:55:09"}
{"level":"error","message":"Error in getPaymentMethod:","service":"shared","statusCode":404,"timestamp":"2024-08-26 12:55:09"}
{"level":"info","message":"Connected to MongoDB: mongodb://localhost:27017/cashdaddy_user_dev","service":"shared","timestamp":"2024-08-26 12:59:25"}
{"level":"info","message":"Connected to Redis: redis://localhost:6379","service":"shared","timestamp":"2024-08-26 12:59:25"}
{"level":"info","message":"Connected to Kafka: localhost:29092","service":"shared","timestamp":"2024-08-26 12:59:25"}
{"level":"info","message":"CacheManager initialized with CacheService.","service":"shared","timestamp":"2024-08-26 12:59:25"}
{"level":"info","message":"Connected Kafka Consumer","service":"shared","timestamp":"2024-08-26 12:59:25"}
{"level":"info","message":"Payment microservice listening on port 3003","service":"shared","timestamp":"2024-08-26 12:59:28"}
{"level":"info","message":"Received message:","offset":"1","partition":0,"service":"shared","timestamp":"2024-08-26 12:59:33","topic":"payment-events","value":"{\"action\":\"getPaymentMethod\",\"payload\":{\"_id\":\"66cb33624864f12a5b94bacd\",\"user\":\"66c94fd65cb63642498b6445\",\"balance\":970,\"currency\":\"USD\",\"stripeCustomerId\":\"cus_Qj8uGWvXpd7d0p\",\"createdAt\":\"2024-08-25T13:36:34.181Z\",\"updatedAt\":\"2024-08-25T13:37:40.905Z\"}}"}
{"level":"info","message":"Handling getPaymentMethods event for user: undefined","service":"shared","timestamp":"2024-08-26 12:59:33"}
{"level":"info","message":"Retrieved payment method for user undefined: undefined","service":"shared","timestamp":"2024-08-26 12:59:33"}
{"level":"info","message":"Received message:","offset":"2","partition":0,"service":"shared","timestamp":"2024-08-26 13:02:20","topic":"payment-events","value":"{\"action\":\"getPaymentMethod\",\"payload\":{\"_id\":\"66cb33624864f12a5b94bacd\",\"user\":\"66c94fd65cb63642498b6445\",\"balance\":970,\"currency\":\"USD\",\"stripeCustomerId\":\"cus_Qj8uGWvXpd7d0p\",\"createdAt\":\"2024-08-25T13:36:34.181Z\",\"updatedAt\":\"2024-08-25T13:37:40.905Z\"}}"}
{"level":"info","message":"Handling getPaymentMethods event for user: undefined","service":"shared","timestamp":"2024-08-26 13:02:20"}
{"level":"info","message":"Retrieved payment method for user undefined: undefined","service":"shared","timestamp":"2024-08-26 13:02:20"}
{"level":"info","message":"Connected to MongoDB: mongodb://localhost:27017/cashdaddy_user_dev","service":"shared","timestamp":"2024-08-26 13:03:05"}
{"level":"info","message":"Connected to Redis: redis://localhost:6379","service":"shared","timestamp":"2024-08-26 13:03:05"}
{"level":"info","message":"Connected to Kafka: localhost:29092","service":"shared","timestamp":"2024-08-26 13:03:05"}
{"level":"info","message":"CacheManager initialized with CacheService.","service":"shared","timestamp":"2024-08-26 13:03:05"}
{"level":"info","message":"Connected Kafka Consumer","service":"shared","timestamp":"2024-08-26 13:03:05"}
{"level":"info","message":"Payment microservice listening on port 3003","service":"shared","timestamp":"2024-08-26 13:03:05"}
{"level":"info","message":"Received message:","offset":"3","partition":0,"service":"shared","timestamp":"2024-08-26 13:03:22","topic":"payment-events","value":"{\"action\":\"getPaymentMethod\",\"payload\":{\"_id\":\"66cb33624864f12a5b94bacd\",\"user\":\"66c94fd65cb63642498b6445\",\"balance\":970,\"currency\":\"USD\",\"stripeCustomerId\":\"cus_Qj8uGWvXpd7d0p\",\"createdAt\":\"2024-08-25T13:36:34.181Z\",\"updatedAt\":\"2024-08-25T13:37:40.905Z\"}}"}
{"level":"info","message":"Handling getPaymentMethods event for user: undefined","service":"shared","timestamp":"2024-08-26 13:03:22"}
{"level":"info","message":"Retrieved payment method for user undefined: undefined","service":"shared","timestamp":"2024-08-26 13:03:22"}
{"level":"info","message":"Received message:","offset":"4","partition":0,"service":"shared","timestamp":"2024-08-26 13:07:03","topic":"payment-events","value":"{\"action\":\"getPaymentMethod\",\"payload\":{\"_id\":\"66cb33624864f12a5b94bacd\",\"user\":\"66c94fd65cb63642498b6445\",\"balance\":970,\"currency\":\"USD\",\"stripeCustomerId\":\"cus_Qj8uGWvXpd7d0p\",\"createdAt\":\"2024-08-25T13:36:34.181Z\",\"updatedAt\":\"2024-08-25T13:37:40.905Z\"}}"}
{"level":"info","message":"Handling getPaymentMethods event for user: undefined","service":"shared","timestamp":"2024-08-26 13:07:03"}
{"level":"info","message":"Retrieved payment method for user undefined: undefined","service":"shared","timestamp":"2024-08-26 13:07:03"}
{"level":"info","message":"Received message:","offset":"5","partition":0,"service":"shared","timestamp":"2024-08-26 13:07:03","topic":"payment-events","value":"{\"action\":\"triggerPaymentIntentAuto\",\"payload\":{\"amount\":100000,\"currency\":\"usd\",\"customerId\":\"cus_Qj8uGWvXpd7d0p\",\"paymentMethodId\":\"pm_card_mastercard\"}}"}
{"level":"info","message":"Handling createPaymentIntent event for customer: cus_Qj8uGWvXpd7d0p","service":"shared","timestamp":"2024-08-26 13:07:03"}
{"level":"info","message":"Creating PaymentIntent: amount=100000, currency=usd, customerId=cus_Qj8uGWvXpd7d0p, paymentMethodId=pm_card_mastercard","service":"shared","timestamp":"2024-08-26 13:07:03"}
{"level":"info","message":"PaymentIntent created: {\"id\":\"pi_3Prv8u00AhGMCNqg1iTs5i8G\",\"object\":\"payment_intent\",\"amount\":100000,\"amount_capturable\":0,\"amount_details\":{\"tip\":{}},\"amount_received\":100000,\"application\":null,\"application_fee_amount\":null,\"automatic_payment_methods\":null,\"canceled_at\":null,\"cancellation_reason\":null,\"capture_method\":\"automatic_async\",\"client_secret\":\"pi_3Prv8u00AhGMCNqg1iTs5i8G_secret_M6l3n6bUZqvrnERC53tJVd3OT\",\"confirmation_method\":\"manual\",\"created\":1724648824,\"currency\":\"usd\",\"customer\":\"cus_Qj8uGWvXpd7d0p\",\"description\":null,\"invoice\":null,\"last_payment_error\":null,\"latest_charge\":\"ch_3Prv8u00AhGMCNqg1dlYFBaI\",\"livemode\":false,\"metadata\":{},\"next_action\":null,\"on_behalf_of\":null,\"payment_method\":\"pm_1Prv8u00AhGMCNqgtOmmrB3B\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"installments\":null,\"mandate_options\":null,\"network\":null,\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"processing\":null,\"receipt_email\":null,\"review\":null,\"setup_future_usage\":null,\"shipping\":null,\"source\":null,\"statement_descriptor\":null,\"statement_descriptor_suffix\":null,\"status\":\"succeeded\",\"transfer_data\":null,\"transfer_group\":null}","service":"shared","timestamp":"2024-08-26 13:07:05"}
{"level":"info","message":"Connected to MongoDB: mongodb://localhost:27017/cashdaddy_user_dev","timestamp":"2024-08-26 13:08:53"}
{"level":"info","message":"Connected to Redis: redis://localhost:6379","timestamp":"2024-08-26 13:08:53"}
{"level":"info","message":"Connected to Kafka: localhost:29092","timestamp":"2024-08-26 13:08:53"}
{"level":"info","message":"CacheManager initialized with CacheService.","timestamp":"2024-08-26 13:08:53"}
{"level":"info","message":"Connected Kafka Consumer","timestamp":"2024-08-26 13:08:53"}
{"level":"info","message":"Payment microservice listening on port 3003","timestamp":"2024-08-26 13:08:56"}
{"level":"info","message":"Received message:","offset":"6","partition":0,"timestamp":"2024-08-26 13:09:00","topic":"payment-events","value":"{\"action\":\"getPaymentMethod\",\"payload\":{\"_id\":\"66cb33624864f12a5b94bacd\",\"user\":\"66c94fd65cb63642498b6445\",\"balance\":970,\"currency\":\"USD\",\"stripeCustomerId\":\"cus_Qj8uGWvXpd7d0p\",\"createdAt\":\"2024-08-25T13:36:34.181Z\",\"updatedAt\":\"2024-08-25T13:37:40.905Z\"}}"}
{"level":"info","message":"Handling getPaymentMethods event for user: undefined","timestamp":"2024-08-26 13:09:00"}
{"level":"info","message":"Retrieved payment method for user undefined: undefined","timestamp":"2024-08-26 13:09:01"}
{"level":"info","message":"Received message:","offset":"7","partition":0,"timestamp":"2024-08-26 13:09:01","topic":"payment-events","value":"{\"action\":\"triggerPaymentIntentAuto\",\"payload\":{\"amount\":100000,\"currency\":\"usd\",\"customerId\":\"cus_Qj8uGWvXpd7d0p\",\"paymentMethodId\":\"pm_card_mastercard\"}}"}
{"level":"info","message":"Handling createPaymentIntent event for customer: cus_Qj8uGWvXpd7d0p","timestamp":"2024-08-26 13:09:01"}
{"level":"info","message":"Creating PaymentIntent: amount=100000, currency=usd, customerId=cus_Qj8uGWvXpd7d0p, paymentMethodId=pm_card_mastercard","timestamp":"2024-08-26 13:09:01"}
{"level":"info","message":"PaymentIntent created: {\"id\":\"pi_3PrvAn00AhGMCNqg1nXtBLkX\",\"object\":\"payment_intent\",\"amount\":100000,\"amount_capturable\":0,\"amount_details\":{\"tip\":{}},\"amount_received\":100000,\"application\":null,\"application_fee_amount\":null,\"automatic_payment_methods\":null,\"canceled_at\":null,\"cancellation_reason\":null,\"capture_method\":\"automatic_async\",\"client_secret\":\"pi_3PrvAn00AhGMCNqg1nXtBLkX_secret_0gCPfNu2Nc4qS83QaXHGUw2yG\",\"confirmation_method\":\"manual\",\"created\":1724648941,\"currency\":\"usd\",\"customer\":\"cus_Qj8uGWvXpd7d0p\",\"description\":null,\"invoice\":null,\"last_payment_error\":null,\"latest_charge\":\"ch_3PrvAn00AhGMCNqg1NLwYFnn\",\"livemode\":false,\"metadata\":{},\"next_action\":null,\"on_behalf_of\":null,\"payment_method\":\"pm_1PrvAn00AhGMCNqgkpYyZhsy\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"installments\":null,\"mandate_options\":null,\"network\":null,\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"processing\":null,\"receipt_email\":null,\"review\":null,\"setup_future_usage\":null,\"shipping\":null,\"source\":null,\"statement_descriptor\":null,\"statement_descriptor_suffix\":null,\"status\":\"succeeded\",\"transfer_data\":null,\"transfer_group\":null}","timestamp":"2024-08-26 13:09:02"}
{"level":"info","message":"Received message:","offset":"8","partition":0,"timestamp":"2024-08-26 13:16:50","topic":"payment-events","value":"{\"action\":\"getPaymentMethod\",\"payload\":{\"userId\":\"66c94fd65cb63642498b6445\",\"paymentMethodId\":\"pm_card_mastercard\"}}"}
{"level":"info","message":"Handling getPaymentMethods event for user: 66c94fd65cb63642498b6445","timestamp":"2024-08-26 13:16:50"}
{"level":"info","message":"Retrieved payment method for user 66c94fd65cb63642498b6445: pm_card_mastercard","timestamp":"2024-08-26 13:16:50"}
{"level":"info","message":"Received message:","offset":"9","partition":0,"timestamp":"2024-08-26 13:16:50","topic":"payment-events","value":"{\"action\":\"triggerPaymentIntentAuto\",\"payload\":{\"amount\":100000,\"currency\":\"usd\",\"customerId\":\"cus_Qj8uGWvXpd7d0p\",\"paymentMethodId\":\"pm_card_mastercard\"}}"}
{"level":"info","message":"Handling createPaymentIntent event for customer: cus_Qj8uGWvXpd7d0p","timestamp":"2024-08-26 13:16:50"}
{"level":"info","message":"Creating PaymentIntent: amount=100000, currency=usd, customerId=cus_Qj8uGWvXpd7d0p, paymentMethodId=pm_card_mastercard","timestamp":"2024-08-26 13:16:50"}
{"level":"info","message":"PaymentIntent created: {\"id\":\"pi_3PrvIM00AhGMCNqg18F9kkKU\",\"object\":\"payment_intent\",\"amount\":100000,\"amount_capturable\":0,\"amount_details\":{\"tip\":{}},\"amount_received\":100000,\"application\":null,\"application_fee_amount\":null,\"automatic_payment_methods\":null,\"canceled_at\":null,\"cancellation_reason\":null,\"capture_method\":\"automatic_async\",\"client_secret\":\"pi_3PrvIM00AhGMCNqg18F9kkKU_secret_rGByQJFJAwkNVFR4f8ZS101tl\",\"confirmation_method\":\"manual\",\"created\":1724649410,\"currency\":\"usd\",\"customer\":\"cus_Qj8uGWvXpd7d0p\",\"description\":null,\"invoice\":null,\"last_payment_error\":null,\"latest_charge\":\"ch_3PrvIM00AhGMCNqg1dk6Eo59\",\"livemode\":false,\"metadata\":{},\"next_action\":null,\"on_behalf_of\":null,\"payment_method\":\"pm_1PrvIM00AhGMCNqgynVcCPpp\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"installments\":null,\"mandate_options\":null,\"network\":null,\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"processing\":null,\"receipt_email\":null,\"review\":null,\"setup_future_usage\":null,\"shipping\":null,\"source\":null,\"statement_descriptor\":null,\"statement_descriptor_suffix\":null,\"status\":\"succeeded\",\"transfer_data\":null,\"transfer_group\":null}","timestamp":"2024-08-26 13:16:51"}
{"level":"info","message":"Connected to MongoDB: mongodb://localhost:27017/cashdaddy_user_dev","timestamp":"2024-08-26 13:18:57"}
{"level":"info","message":"Connected to Redis: redis://localhost:6379","timestamp":"2024-08-26 13:18:57"}
{"level":"info","message":"Connected to Kafka: localhost:29092","timestamp":"2024-08-26 13:18:57"}
{"level":"info","message":"CacheManager initialized with CacheService.","timestamp":"2024-08-26 13:18:57"}
{"level":"info","message":"Connected Kafka Consumer","timestamp":"2024-08-26 13:18:57"}
{"level":"info","message":"Payment microservice listening on port 3003","timestamp":"2024-08-26 13:19:00"}
{"level":"error","message":"Error: Validation failed\n    at file:///home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/@cash-daddy/shared/dist/middlewares/validation.middleware.js:7:19\n    at Layer.handle [as handle_request] (/home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/express/lib/router/layer.js:95:5)\n    at next (/home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/express/lib/router/route.js:149:13)\n    at file:///home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/@cash-daddy/shared/dist/middlewares/auth.middleware.js:61:17\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","timestamp":"2024-08-26 13:20:35"}
{"level":"info","message":"Response: 400 An error occurred","timestamp":"2024-08-26 13:20:35"}
{"level":"info","message":"Connected to MongoDB: mongodb://localhost:27017/cashdaddy_user_dev","timestamp":"2024-08-26 13:22:22"}
{"level":"info","message":"Connected to Redis: redis://localhost:6379","timestamp":"2024-08-26 13:22:22"}
{"level":"info","message":"Connected to Kafka: localhost:29092","timestamp":"2024-08-26 13:22:22"}
{"level":"info","message":"CacheManager initialized with CacheService.","timestamp":"2024-08-26 13:22:22"}
{"level":"info","message":"Connected Kafka Consumer","timestamp":"2024-08-26 13:22:22"}
{"level":"info","message":"Payment microservice listening on port 3003","timestamp":"2024-08-26 13:22:46"}
{"level":"error","message":"Error: Validation failed\n    at file:///home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/@cash-daddy/shared/dist/middlewares/validation.middleware.js:7:19\n    at Layer.handle [as handle_request] (/home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/express/lib/router/layer.js:95:5)\n    at next (/home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/express/lib/router/route.js:149:13)\n    at file:///home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/@cash-daddy/shared/dist/middlewares/auth.middleware.js:61:17\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","timestamp":"2024-08-26 13:22:48"}
{"level":"info","message":"Response: 400 An error occurred","timestamp":"2024-08-26 13:22:48"}
{"level":"error","message":"Error: Validation failed\n    at file:///home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/@cash-daddy/shared/dist/middlewares/validation.middleware.js:7:19\n    at Layer.handle [as handle_request] (/home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/express/lib/router/layer.js:95:5)\n    at next (/home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/express/lib/router/route.js:149:13)\n    at file:///home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/@cash-daddy/shared/dist/middlewares/auth.middleware.js:61:17\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","timestamp":"2024-08-26 13:22:51"}
{"level":"info","message":"Response: 400 An error occurred","timestamp":"2024-08-26 13:22:51"}
{"level":"error","message":"SyntaxError: Unexpected token 'p', ...\"hodType\": pm_card_ma\"... is not valid JSON\n    at JSON.parse (<anonymous>)\n    at parse (/home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/body-parser/lib/types/json.js:92:19)\n    at /home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/body-parser/lib/read.js:128:18\n    at AsyncResource.runInAsyncScope (node:async_hooks:206:9)\n    at invokeCallback (/home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/raw-body/index.js:238:16)\n    at done (/home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/raw-body/index.js:227:7)\n    at IncomingMessage.onEnd (/home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/raw-body/index.js:287:7)\n    at IncomingMessage.emit (node:events:520:28)\n    at endReadableNT (node:internal/streams/readable:1696:12)\n    at process.processTicksAndRejections (node:internal/process/task_queues:82:21)","timestamp":"2024-08-26 13:22:58"}
{"level":"info","message":"Response: 503 Server error","timestamp":"2024-08-26 13:22:58"}
{"level":"error","message":"Error: Validation failed\n    at file:///home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/@cash-daddy/shared/dist/middlewares/validation.middleware.js:7:19\n    at Layer.handle [as handle_request] (/home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/express/lib/router/layer.js:95:5)\n    at next (/home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/express/lib/router/route.js:149:13)\n    at file:///home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/@cash-daddy/shared/dist/middlewares/auth.middleware.js:61:17\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","timestamp":"2024-08-26 13:23:09"}
{"level":"info","message":"Response: 400 An error occurred","timestamp":"2024-08-26 13:23:09"}
{"level":"error","message":"Error: Validation failed\n    at file:///home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/@cash-daddy/shared/dist/middlewares/validation.middleware.js:7:19\n    at Layer.handle [as handle_request] (/home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/express/lib/router/layer.js:95:5)\n    at next (/home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/express/lib/router/route.js:149:13)\n    at file:///home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/@cash-daddy/shared/dist/middlewares/auth.middleware.js:61:17\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","timestamp":"2024-08-26 13:23:55"}
{"level":"info","message":"Response: 400 An error occurred","timestamp":"2024-08-26 13:23:55"}
{"level":"info","message":"Connected to MongoDB: mongodb://localhost:27017/cashdaddy_user_dev","timestamp":"2024-08-26 13:24:22"}
{"level":"info","message":"Connected to Redis: redis://localhost:6379","timestamp":"2024-08-26 13:24:22"}
{"level":"info","message":"Connected to Kafka: localhost:29092","timestamp":"2024-08-26 13:24:22"}
{"level":"info","message":"CacheManager initialized with CacheService.","timestamp":"2024-08-26 13:24:22"}
{"level":"info","message":"Connected Kafka Consumer","timestamp":"2024-08-26 13:24:22"}
{"level":"info","message":"Payment microservice listening on port 3003","timestamp":"2024-08-26 13:24:46"}
{"level":"error","message":"Error creating payment method:","statusCode":400,"timestamp":"2024-08-26 13:25:19"}
{"level":"info","message":"Response: 400 Invalid payment method details","timestamp":"2024-08-26 13:25:19"}
{"level":"info","message":"Connected to MongoDB: mongodb://localhost:27017/cashdaddy_user_dev","timestamp":"2024-08-26 14:01:56"}
{"level":"info","message":"Connected to Redis: redis://localhost:6379","timestamp":"2024-08-26 14:01:56"}
{"level":"info","message":"Connected to Kafka: localhost:29092","timestamp":"2024-08-26 14:01:56"}
{"level":"info","message":"CacheManager initialized with CacheService.","timestamp":"2024-08-26 14:01:56"}
{"level":"info","message":"Connected Kafka Consumer","timestamp":"2024-08-26 14:01:56"}
{"level":"info","message":"Payment microservice listening on port 3003","timestamp":"2024-08-26 14:01:59"}
{"level":"error","message":"Error creating payment method:","statusCode":400,"timestamp":"2024-08-26 14:10:01"}
{"level":"info","message":"Response: 400 Invalid payment method details","timestamp":"2024-08-26 14:10:01"}
{"level":"info","message":"Connected to MongoDB: mongodb://localhost:27017/cashdaddy_user_dev","timestamp":"2024-08-26 14:13:58"}
{"level":"info","message":"Connected to Redis: redis://localhost:6379","timestamp":"2024-08-26 14:13:58"}
{"level":"info","message":"Connected to Kafka: localhost:29092","timestamp":"2024-08-26 14:13:58"}
{"level":"info","message":"CacheManager initialized with CacheService.","timestamp":"2024-08-26 14:13:58"}
{"level":"info","message":"Connected Kafka Consumer","timestamp":"2024-08-26 14:13:58"}
{"level":"info","message":"Payment microservice listening on port 3003","timestamp":"2024-08-26 14:14:19"}
{"level":"error","message":"Error: Validation failed\n    at file:///home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/@cash-daddy/shared/dist/middlewares/validation.middleware.js:7:19\n    at Layer.handle [as handle_request] (/home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/express/lib/router/layer.js:95:5)\n    at next (/home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/express/lib/router/route.js:149:13)\n    at file:///home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/@cash-daddy/shared/dist/middlewares/auth.middleware.js:61:17\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","timestamp":"2024-08-26 14:14:27"}
{"level":"info","message":"Response: 400 An error occurred","timestamp":"2024-08-26 14:14:27"}
{"level":"info","message":"Connected to MongoDB: mongodb://localhost:27017/cashdaddy_user_dev","timestamp":"2024-08-26 14:15:48"}
{"level":"info","message":"Connected to Redis: redis://localhost:6379","timestamp":"2024-08-26 14:15:48"}
{"level":"info","message":"Connected to Kafka: localhost:29092","timestamp":"2024-08-26 14:15:48"}
{"level":"info","message":"CacheManager initialized with CacheService.","timestamp":"2024-08-26 14:15:48"}
{"level":"info","message":"Connected Kafka Consumer","timestamp":"2024-08-26 14:15:48"}
{"level":"info","message":"Payment microservice listening on port 3003","timestamp":"2024-08-26 14:16:09"}
{"level":"error","message":"Error creating payment method: Invalid object","timestamp":"2024-08-26 14:16:12"}
{"level":"error","message":"Error creating payment method:","timestamp":"2024-08-26 14:16:12"}
{"level":"info","message":"Response: 500 Failed to create payment method: Invalid object","timestamp":"2024-08-26 14:16:12"}
{"level":"info","message":"Connected to MongoDB: mongodb://localhost:27017/cashdaddy_user_dev","timestamp":"2024-08-26 14:18:34"}
{"level":"info","message":"Connected to Redis: redis://localhost:6379","timestamp":"2024-08-26 14:18:34"}
{"level":"info","message":"Connected to Kafka: localhost:29092","timestamp":"2024-08-26 14:18:34"}
{"level":"info","message":"CacheManager initialized with CacheService.","timestamp":"2024-08-26 14:18:34"}
{"level":"info","message":"Connected Kafka Consumer","timestamp":"2024-08-26 14:18:34"}
{"level":"info","message":"Payment microservice listening on port 3003","timestamp":"2024-08-26 14:18:37"}
{"level":"error","message":"Error creating payment method: Invalid object","timestamp":"2024-08-26 14:19:13"}
{"level":"error","message":"Error creating payment method:","timestamp":"2024-08-26 14:19:13"}
{"level":"info","message":"Response: 500 Failed to create payment method: Invalid object","timestamp":"2024-08-26 14:19:13"}
{"level":"info","message":"Connected to MongoDB: mongodb://localhost:27017/cashdaddy_user_dev","timestamp":"2024-08-26 14:23:22"}
{"level":"info","message":"Connected to Redis: redis://localhost:6379","timestamp":"2024-08-26 14:23:22"}
{"level":"info","message":"Connected to Kafka: localhost:29092","timestamp":"2024-08-26 14:23:22"}
{"level":"info","message":"CacheManager initialized with CacheService.","timestamp":"2024-08-26 14:23:22"}
{"level":"info","message":"Connected Kafka Consumer","timestamp":"2024-08-26 14:23:22"}
{"level":"info","message":"Payment microservice listening on port 3003","timestamp":"2024-08-26 14:23:42"}
{"level":"error","message":"Error: Validation failed\n    at file:///home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/@cash-daddy/shared/dist/middlewares/validation.middleware.js:7:19\n    at Layer.handle [as handle_request] (/home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/express/lib/router/layer.js:95:5)\n    at next (/home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/express/lib/router/route.js:149:13)\n    at file:///home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/@cash-daddy/shared/dist/middlewares/auth.middleware.js:61:17\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","timestamp":"2024-08-26 14:24:50"}
{"level":"info","message":"Response: 400 An error occurred","timestamp":"2024-08-26 14:24:50"}
{"level":"info","message":"Connected to MongoDB: mongodb://localhost:27017/cashdaddy_user_dev","timestamp":"2024-08-26 14:25:57"}
{"level":"info","message":"Connected to Redis: redis://localhost:6379","timestamp":"2024-08-26 14:25:57"}
{"level":"info","message":"Connected to Kafka: localhost:29092","timestamp":"2024-08-26 14:25:57"}
{"level":"info","message":"CacheManager initialized with CacheService.","timestamp":"2024-08-26 14:25:57"}
{"level":"info","message":"Connected Kafka Consumer","timestamp":"2024-08-26 14:25:57"}
{"level":"info","message":"Payment microservice listening on port 3003","timestamp":"2024-08-26 14:26:17"}
{"level":"error","message":"Error: Validation failed\n    at file:///home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/@cash-daddy/shared/dist/middlewares/validation.middleware.js:7:19\n    at Layer.handle [as handle_request] (/home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/express/lib/router/layer.js:95:5)\n    at next (/home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/express/lib/router/route.js:149:13)\n    at file:///home/jireh/projects/stratpoint/CashDaddy/payment-service/node_modules/@cash-daddy/shared/dist/middlewares/auth.middleware.js:61:17\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","timestamp":"2024-08-26 14:26:49"}
{"level":"info","message":"Response: 400 An error occurred","timestamp":"2024-08-26 14:26:49"}
{"level":"info","message":"Connected to MongoDB: mongodb://localhost:27017/cashdaddy_user_dev","timestamp":"2024-08-26 14:27:11"}
{"level":"info","message":"Connected to Redis: redis://localhost:6379","timestamp":"2024-08-26 14:27:11"}
{"level":"info","message":"Connected to Kafka: localhost:29092","timestamp":"2024-08-26 14:27:11"}
{"level":"info","message":"CacheManager initialized with CacheService.","timestamp":"2024-08-26 14:27:11"}
{"level":"info","message":"Connected Kafka Consumer","timestamp":"2024-08-26 14:27:11"}
{"level":"info","message":"Payment microservice listening on port 3003","timestamp":"2024-08-26 14:27:32"}
{"level":"error","message":"Error creating payment method: Sending credit card numbers directly to the Stripe API is generally unsafe. We suggest you use test tokens that map to the test card you are using, see https://stripe.com/docs/testing. To enable raw card data APIs in test mode, see https://support.stripe.com/questions/enabling-access-to-raw-card-data-apis.","timestamp":"2024-08-26 14:27:52"}
{"level":"error","message":"Error creating payment method:","timestamp":"2024-08-26 14:27:52"}
{"level":"info","message":"Response: 500 Failed to create payment method: Sending credit card numbers directly to the Stripe API is generally unsafe. We suggest you use test tokens that map to the test card you are using, see https://stripe.com/docs/testing. To enable raw card data APIs in test mode, see https://support.stripe.com/questions/enabling-access-to-raw-card-data-apis.","timestamp":"2024-08-26 14:27:52"}
{"level":"info","message":"Connected to MongoDB: mongodb://localhost:27017/cashdaddy_user_dev","timestamp":"2024-08-26 14:37:56"}
{"level":"info","message":"Connected to Redis: redis://localhost:6379","timestamp":"2024-08-26 14:37:56"}
{"level":"info","message":"Connected to Kafka: localhost:29092","timestamp":"2024-08-26 14:37:56"}
{"level":"info","message":"CacheManager initialized with CacheService.","timestamp":"2024-08-26 14:37:56"}
{"level":"info","message":"Connected Kafka Consumer","timestamp":"2024-08-26 14:37:56"}
{"level":"info","message":"Payment microservice listening on port 3003","timestamp":"2024-08-26 14:38:13"}
{"level":"error","message":"Error creating payment method:","statusCode":400,"timestamp":"2024-08-26 14:38:41"}
{"level":"info","message":"Response: 400 Invalid payment method details","timestamp":"2024-08-26 14:38:41"}
{"level":"info","message":"Connected to MongoDB: mongodb://localhost:27017/cashdaddy_user_dev","timestamp":"2024-08-26 14:40:48"}
{"level":"info","message":"Connected to Redis: redis://localhost:6379","timestamp":"2024-08-26 14:40:48"}
{"level":"info","message":"Connected to Kafka: localhost:29092","timestamp":"2024-08-26 14:40:48"}
{"level":"info","message":"CacheManager initialized with CacheService.","timestamp":"2024-08-26 14:40:48"}
{"level":"info","message":"Connected Kafka Consumer","timestamp":"2024-08-26 14:40:48"}
{"level":"info","message":"Payment microservice listening on port 3003","timestamp":"2024-08-26 14:41:13"}
{"level":"error","message":"Error creating payment method:","timestamp":"2024-08-26 14:42:07"}
{"level":"info","message":"Response: 500 Cannot read properties of null (reading 'stripeCustomerId')","timestamp":"2024-08-26 14:42:07"}
{"level":"info","message":"Connected to MongoDB: mongodb://localhost:27017/cashdaddy_user_dev","timestamp":"2024-08-26 14:43:36"}
{"level":"info","message":"Connected to Redis: redis://localhost:6379","timestamp":"2024-08-26 14:43:36"}
{"level":"info","message":"Connected to Kafka: localhost:29092","timestamp":"2024-08-26 14:43:36"}
{"level":"info","message":"CacheManager initialized with CacheService.","timestamp":"2024-08-26 14:43:36"}
{"level":"info","message":"Connected Kafka Consumer","timestamp":"2024-08-26 14:43:36"}
{"level":"info","message":"Payment microservice listening on port 3003","timestamp":"2024-08-26 14:43:58"}
{"level":"error","message":"Error creating payment method:","timestamp":"2024-08-26 14:44:23"}
{"level":"info","message":"Response: 500 Cannot read properties of null (reading 'stripeCustomerId')","timestamp":"2024-08-26 14:44:23"}
{"level":"info","message":"Connected to MongoDB: mongodb://localhost:27017/cashdaddy_user_dev","timestamp":"2024-08-26 14:46:12"}
{"level":"info","message":"Connected to Redis: redis://localhost:6379","timestamp":"2024-08-26 14:46:12"}
{"level":"info","message":"Connected to Kafka: localhost:29092","timestamp":"2024-08-26 14:46:12"}
{"level":"info","message":"CacheManager initialized with CacheService.","timestamp":"2024-08-26 14:46:12"}
{"level":"info","message":"Connected Kafka Consumer","timestamp":"2024-08-26 14:46:12"}
{"level":"info","message":"Payment microservice listening on port 3003","timestamp":"2024-08-26 14:46:33"}
{"level":"info","message":"Received createPaymentMethod request for user 66c94fd65cb63642498b6445","timestamp":"2024-08-26 14:46:37"}
{"level":"error","message":"Error creating payment method:","timestamp":"2024-08-26 14:46:47"}
{"level":"info","message":"Response: 500 Cannot read properties of null (reading 'stripeCustomerId')","timestamp":"2024-08-26 14:46:47"}
{"level":"info","message":"Received createPaymentMethod request for user 66c94fd65cb63642498b6445","timestamp":"2024-08-26 14:48:07"}
{"level":"error","message":"Error creating payment method:","timestamp":"2024-08-26 14:48:17"}
{"level":"info","message":"Response: 500 Cannot read properties of null (reading 'stripeCustomerId')","timestamp":"2024-08-26 14:48:17"}
{"level":"info","message":"Received createPaymentMethod request for user 66c94fd65cb63642498b6445","timestamp":"2024-08-26 14:50:29"}
{"level":"error","message":"Error creating payment method:","timestamp":"2024-08-26 14:50:39"}
{"level":"info","message":"Response: 500 Cannot read properties of null (reading 'stripeCustomerId')","timestamp":"2024-08-26 14:50:39"}
{"level":"info","message":"Received createPaymentMethod request for user 66c94fd65cb63642498b6445","timestamp":"2024-08-26 14:51:51"}
{"level":"error","message":"Error creating payment method:","timestamp":"2024-08-26 14:52:01"}
{"level":"info","message":"Response: 500 Cannot read properties of null (reading 'stripeCustomerId')","timestamp":"2024-08-26 14:52:01"}
{"level":"info","message":"Received createPaymentMethod request for user 66c94fd65cb63642498b6445","timestamp":"2024-08-26 14:53:39"}
{"level":"error","message":"Error creating payment method:","timestamp":"2024-08-26 14:53:49"}
{"level":"info","message":"Response: 500 Cannot read properties of null (reading 'stripeCustomerId')","timestamp":"2024-08-26 14:53:49"}
{"level":"info","message":"Received createPaymentMethod request for user 66c94fd65cb63642498b6445","timestamp":"2024-08-26 14:57:27"}
{"level":"error","message":"Error creating payment method:","timestamp":"2024-08-26 14:57:37"}
{"level":"info","message":"Response: 500 Cannot read properties of null (reading 'stripeCustomerId')","timestamp":"2024-08-26 14:57:37"}
{"level":"info","message":"Received createPaymentMethod request for user 66c94fd65cb63642498b6445","timestamp":"2024-08-26 14:59:05"}
{"level":"info","message":"Received message:","offset":"10","partition":0,"timestamp":"2024-08-26 14:59:05","topic":"payment-events","value":"{\"action\":\"returnData\",\"payload\":{\"_id\":\"66cb33624864f12a5b94bacd\",\"user\":\"66c94fd65cb63642498b6445\",\"balance\":970,\"currency\":\"USD\",\"stripeCustomerId\":\"cus_Qj8uGWvXpd7d0p\",\"createdAt\":\"2024-08-25T13:36:34.181Z\",\"updatedAt\":\"2024-08-25T13:37:40.905Z\"}}"}
{"level":"info","message":"Payment method pm_card_visa attached to customer cus_Qj8uGWvXpd7d0p","timestamp":"2024-08-26 14:59:06"}
{"level":"info","message":"Response: 200 Payment method created successfully","timestamp":"2024-08-26 14:59:06"}
{"level":"info","message":"Connected to MongoDB: mongodb://localhost:27017/cashdaddy_user_dev","timestamp":"2024-08-26 15:01:09"}
{"level":"info","message":"Connected to Redis: redis://localhost:6379","timestamp":"2024-08-26 15:01:09"}
{"level":"info","message":"Connected to Kafka: localhost:29092","timestamp":"2024-08-26 15:01:09"}
{"level":"info","message":"CacheManager initialized with CacheService.","timestamp":"2024-08-26 15:01:09"}
{"level":"info","message":"Connected Kafka Consumer","timestamp":"2024-08-26 15:01:09"}
{"level":"info","message":"Payment microservice listening on port 3003","timestamp":"2024-08-26 15:01:30"}
{"level":"info","message":"Received message:","offset":"11","partition":0,"timestamp":"2024-08-26 15:01:44","topic":"payment-events","value":"{\"action\":\"returnData\",\"payload\":{\"_id\":\"66cb33624864f12a5b94bacd\",\"user\":\"66c94fd65cb63642498b6445\",\"balance\":970,\"currency\":\"USD\",\"stripeCustomerId\":\"cus_Qj8uGWvXpd7d0p\",\"createdAt\":\"2024-08-25T13:36:34.181Z\",\"updatedAt\":\"2024-08-25T13:37:40.905Z\"}}"}
{"level":"info","message":"Cacheable decorator: caching method getPaymentMethods with key payment-method:66c94fd65cb63642498b6445","timestamp":"2024-08-26 15:01:44"}
{"level":"info","message":"Attempting to cache method with key: payment-method:66c94fd65cb63642498b6445","timestamp":"2024-08-26 15:01:44"}
{"level":"info","message":"Cache miss: payment-method:66c94fd65cb63642498b6445. Executing method and caching result.","timestamp":"2024-08-26 15:01:44"}
{"level":"info","message":"Retrieved 0 payment methods for user 66c94fd65cb63642498b6445","timestamp":"2024-08-26 15:01:44"}
{"level":"info","message":"Method result cached with key: payment-method:66c94fd65cb63642498b6445","timestamp":"2024-08-26 15:01:44"}
{"level":"info","message":"Response: 200 Payment methods retrieved successfully","timestamp":"2024-08-26 15:01:44"}
{"level":"info","message":"Detached payment method pm_1PrwtL00AhGMCNqgHmugRk6r","timestamp":"2024-08-26 15:01:51"}
{"kind":"ObjectId","level":"error","message":"Error in deletePaymentMethod:","path":"_id","reason":{},"stringValue":"\"pm_1PrwtL00AhGMCNqgHmugRk6r\"","timestamp":"2024-08-26 15:01:51","value":"pm_1PrwtL00AhGMCNqgHmugRk6r","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Error deleting payment method:","path":"_id","reason":{},"stringValue":"\"pm_1PrwtL00AhGMCNqgHmugRk6r\"","timestamp":"2024-08-26 15:01:51","value":"pm_1PrwtL00AhGMCNqgHmugRk6r","valueType":"string"}
{"level":"info","message":"Response: 500 Cast to ObjectId failed for value \"pm_1PrwtL00AhGMCNqgHmugRk6r\" (type string) at path \"_id\" for model \"PaymentMethod\"","timestamp":"2024-08-26 15:01:51"}
{"level":"info","message":"Received createPaymentMethod request for user 66c94fd65cb63642498b6445","timestamp":"2024-08-26 15:02:07"}
{"level":"info","message":"Received message:","offset":"12","partition":0,"timestamp":"2024-08-26 15:02:07","topic":"payment-events","value":"{\"action\":\"returnData\",\"payload\":{\"_id\":\"66cb33624864f12a5b94bacd\",\"user\":\"66c94fd65cb63642498b6445\",\"balance\":970,\"currency\":\"USD\",\"stripeCustomerId\":\"cus_Qj8uGWvXpd7d0p\",\"createdAt\":\"2024-08-25T13:36:34.181Z\",\"updatedAt\":\"2024-08-25T13:37:40.905Z\"}}"}
{"level":"info","message":"Payment method pm_card_visa attached to customer cus_Qj8uGWvXpd7d0p","timestamp":"2024-08-26 15:02:08"}
{"level":"info","message":"Payment method pm_1PrwwH00AhGMCNqgo1W2ZjGa is already attached to customer cus_Qj8uGWvXpd7d0p","timestamp":"2024-08-26 15:02:09"}
{"level":"info","message":"Created payment method for user 66c94fd65cb63642498b6445: pm_1PrwwH00AhGMCNqgo1W2ZjGa","timestamp":"2024-08-26 15:02:09"}
{"level":"info","message":"Invalidating cache with key: payment-method:66c94fd65cb63642498b6445:pm_1PrwwH00AhGMCNqgo1W2ZjGa:pm_card_visa","timestamp":"2024-08-26 15:02:09"}
{"level":"info","message":"Response: 200 Payment method created successfully","timestamp":"2024-08-26 15:02:09"}
{"level":"info","message":"Received message:","offset":"13","partition":0,"timestamp":"2024-08-26 15:02:51","topic":"payment-events","value":"{\"action\":\"returnData\",\"payload\":{\"_id\":\"66cb33624864f12a5b94bacd\",\"user\":\"66c94fd65cb63642498b6445\",\"balance\":970,\"currency\":\"USD\",\"stripeCustomerId\":\"cus_Qj8uGWvXpd7d0p\",\"createdAt\":\"2024-08-25T13:36:34.181Z\",\"updatedAt\":\"2024-08-25T13:37:40.905Z\"}}"}
{"level":"info","message":"Cacheable decorator: caching method getPaymentMethods with key payment-method:66c94fd65cb63642498b6445","timestamp":"2024-08-26 15:02:51"}
{"level":"info","message":"Attempting to cache method with key: payment-method:66c94fd65cb63642498b6445","timestamp":"2024-08-26 15:02:51"}
{"level":"info","message":"Cache hit: payment-method:66c94fd65cb63642498b6445","timestamp":"2024-08-26 15:02:51"}
{"level":"info","message":"Response: 200 Payment methods retrieved successfully","timestamp":"2024-08-26 15:02:51"}
{"level":"info","message":"Received message:","offset":"14","partition":0,"timestamp":"2024-08-26 15:03:25","topic":"payment-events","value":"{\"action\":\"getPaymentMethod\",\"payload\":{\"userId\":\"66c94fd65cb63642498b6445\",\"paymentMethodId\":\"pm_card_mastercard\"}}"}
{"level":"info","message":"Handling getPaymentMethods event for user: 66c94fd65cb63642498b6445","timestamp":"2024-08-26 15:03:25"}
{"level":"info","message":"Retrieved payment method for user 66c94fd65cb63642498b6445: pm_card_mastercard","timestamp":"2024-08-26 15:03:25"}
{"level":"info","message":"Received message:","offset":"15","partition":0,"timestamp":"2024-08-26 15:03:25","topic":"payment-events","value":"{\"action\":\"triggerPaymentIntentAuto\",\"payload\":{\"amount\":100000,\"currency\":\"usd\",\"customerId\":\"cus_Qj8uGWvXpd7d0p\",\"paymentMethodId\":\"pm_card_mastercard\"}}"}
{"level":"info","message":"Handling createPaymentIntent event for customer: cus_Qj8uGWvXpd7d0p","timestamp":"2024-08-26 15:03:25"}
{"level":"info","message":"Creating PaymentIntent: amount=100000, currency=usd, customerId=cus_Qj8uGWvXpd7d0p, paymentMethodId=pm_card_mastercard","timestamp":"2024-08-26 15:03:25"}
{"level":"info","message":"PaymentIntent created: {\"id\":\"pi_3PrwxW00AhGMCNqg1gBm62Kh\",\"object\":\"payment_intent\",\"amount\":100000,\"amount_capturable\":0,\"amount_details\":{\"tip\":{}},\"amount_received\":100000,\"application\":null,\"application_fee_amount\":null,\"automatic_payment_methods\":null,\"canceled_at\":null,\"cancellation_reason\":null,\"capture_method\":\"automatic_async\",\"client_secret\":\"pi_3PrwxW00AhGMCNqg1gBm62Kh_secret_7Et6scHV7YazaGnPmmIA92N0Z\",\"confirmation_method\":\"manual\",\"created\":1724655806,\"currency\":\"usd\",\"customer\":\"cus_Qj8uGWvXpd7d0p\",\"description\":null,\"invoice\":null,\"last_payment_error\":null,\"latest_charge\":\"ch_3PrwxW00AhGMCNqg1vf3bsWn\",\"livemode\":false,\"metadata\":{},\"next_action\":null,\"on_behalf_of\":null,\"payment_method\":\"pm_1PrwxW00AhGMCNqg1gls8CCj\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"installments\":null,\"mandate_options\":null,\"network\":null,\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"processing\":null,\"receipt_email\":null,\"review\":null,\"setup_future_usage\":null,\"shipping\":null,\"source\":null,\"statement_descriptor\":null,\"statement_descriptor_suffix\":null,\"status\":\"succeeded\",\"transfer_data\":null,\"transfer_group\":null}","timestamp":"2024-08-26 15:03:26"}
{"level":"info","message":"Received message:","offset":"16","partition":0,"timestamp":"2024-08-26 15:03:47","topic":"payment-events","value":"{\"action\":\"createPayout\",\"payload\":{\"_id\":\"66cb33624864f12a5b94bacd\",\"user\":\"66c94fd65cb63642498b6445\",\"balance\":970,\"currency\":\"USD\",\"stripeCustomerId\":\"cus_Qj8uGWvXpd7d0p\",\"createdAt\":\"2024-08-25T13:36:34.181Z\",\"updatedAt\":\"2024-08-25T13:37:40.905Z\"}}"}
{"level":"info","message":"Handling createPayout event for user: undefined","timestamp":"2024-08-26 15:03:47"}
{"level":"info","message":"Simulated payout for customer undefined: {\"id\":\"po_simulated_1ccb1ec8beae221a38e44935a7361b79\",\"status\":\"paid\",\"amount\":null,\"currency\":\"usd\",\"arrival_date\":1724742228,\"method\":\"standard\",\"type\":\"bank_account\"}","timestamp":"2024-08-26 15:03:48"}
{"level":"info","message":"Connected to MongoDB: mongodb://localhost:27017/cashdaddy_user_dev","timestamp":"2024-08-26 15:12:24"}
{"level":"info","message":"Connected to Redis: redis://localhost:6379","timestamp":"2024-08-26 15:12:24"}
{"level":"info","message":"Connected to Kafka: localhost:29092","timestamp":"2024-08-26 15:12:24"}
{"level":"info","message":"CacheManager initialized with CacheService.","timestamp":"2024-08-26 15:12:24"}
{"level":"info","message":"Connected Kafka Consumer","timestamp":"2024-08-26 15:12:24"}
{"level":"info","message":"Payment microservice listening on port 3003","timestamp":"2024-08-26 15:12:47"}
{"level":"info","message":"Received message:","offset":"17","partition":0,"timestamp":"2024-08-26 15:12:47","topic":"payment-events","value":"{\"action\":\"getPaymentMethod\",\"payload\":{\"userId\":\"66c94fd65cb63642498b6445\",\"paymentMethodId\":\"pm_card_mastercard\"}}"}
{"level":"info","message":"Handling getPaymentMethods event for user: 66c94fd65cb63642498b6445","timestamp":"2024-08-26 15:12:47"}
{"level":"info","message":"Retrieved payment method for user 66c94fd65cb63642498b6445: pm_card_mastercard","timestamp":"2024-08-26 15:12:47"}
{"level":"info","message":"Received message:","offset":"18","partition":0,"timestamp":"2024-08-26 15:12:47","topic":"payment-events","value":"{\"action\":\"triggerPaymentIntentAuto\",\"payload\":{\"amount\":100000,\"currency\":\"usd\",\"customerId\":\"cus_Qj8uGWvXpd7d0p\",\"paymentMethodId\":\"pm_card_mastercard\"}}"}
{"level":"info","message":"Handling createPaymentIntent event for customer: cus_Qj8uGWvXpd7d0p","timestamp":"2024-08-26 15:12:47"}
{"level":"info","message":"Creating PaymentIntent: amount=100000, currency=usd, customerId=cus_Qj8uGWvXpd7d0p, paymentMethodId=pm_card_mastercard","timestamp":"2024-08-26 15:12:47"}
{"level":"info","message":"PaymentIntent created: {\"id\":\"pi_3Prx6b00AhGMCNqg1G5xmBiM\",\"object\":\"payment_intent\",\"amount\":100000,\"amount_capturable\":0,\"amount_details\":{\"tip\":{}},\"amount_received\":100000,\"application\":null,\"application_fee_amount\":null,\"automatic_payment_methods\":null,\"canceled_at\":null,\"cancellation_reason\":null,\"capture_method\":\"automatic_async\",\"client_secret\":\"pi_3Prx6b00AhGMCNqg1G5xmBiM_secret_hqae1muNP8Ym2mESKy8jUOdfI\",\"confirmation_method\":\"manual\",\"created\":1724656369,\"currency\":\"usd\",\"customer\":\"cus_Qj8uGWvXpd7d0p\",\"description\":null,\"invoice\":null,\"last_payment_error\":null,\"latest_charge\":\"ch_3Prx6b00AhGMCNqg1LxmJaui\",\"livemode\":false,\"metadata\":{},\"next_action\":null,\"on_behalf_of\":null,\"payment_method\":\"pm_1Prx6b00AhGMCNqgR0vhg7i2\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"installments\":null,\"mandate_options\":null,\"network\":null,\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"processing\":null,\"receipt_email\":null,\"review\":null,\"setup_future_usage\":null,\"shipping\":null,\"source\":null,\"statement_descriptor\":null,\"statement_descriptor_suffix\":null,\"status\":\"succeeded\",\"transfer_data\":null,\"transfer_group\":null}","timestamp":"2024-08-26 15:12:49"}
{"level":"info","message":"Received message:","offset":"19","partition":0,"timestamp":"2024-08-26 15:12:52","topic":"payment-events","value":"{\"action\":\"createPayout\",\"payload\":{\"customerId\":\"cus_Qj8uGWvXpd7d0p\",\"amount\":100}}"}
{"level":"info","message":"Handling createPayout event for customer: cus_Qj8uGWvXpd7d0p","timestamp":"2024-08-26 15:12:52"}
{"level":"info","message":"Simulated payout for customer cus_Qj8uGWvXpd7d0p: {\"id\":\"po_simulated_ba0ed003fc18db4042f45bd6632366c5\",\"status\":\"paid\",\"amount\":10000,\"currency\":\"usd\",\"arrival_date\":1724742773,\"method\":\"standard\",\"type\":\"bank_account\"}","timestamp":"2024-08-26 15:12:53"}
{"level":"info","message":"Connected to MongoDB: mongodb://localhost:27017/cashdaddy_user_dev","timestamp":"2024-08-26 15:15:02"}
{"level":"info","message":"Connected to Redis: redis://localhost:6379","timestamp":"2024-08-26 15:15:02"}
{"level":"info","message":"Connected to Kafka: localhost:29092","timestamp":"2024-08-26 15:15:02"}
{"level":"info","message":"CacheManager initialized with CacheService.","timestamp":"2024-08-26 15:15:02"}
{"level":"info","message":"Connected Kafka Consumer","timestamp":"2024-08-26 15:15:02"}
{"level":"info","message":"Payment microservice listening on port 3003","timestamp":"2024-08-26 15:15:05"}
{"level":"info","message":"Received message:","offset":"20","partition":0,"timestamp":"2024-08-26 15:16:10","topic":"payment-events","value":"{\"action\":\"createPayout\",\"payload\":{\"customerId\":\"cus_Qj8uGWvXpd7d0p\",\"amount\":100}}"}
{"level":"info","message":"Handling createPayout event for customer: cus_Qj8uGWvXpd7d0p","timestamp":"2024-08-26 15:16:10"}
{"level":"info","message":"Simulated payout for customer cus_Qj8uGWvXpd7d0p: {\"id\":\"po_simulated_202ba6b33c2c1697ac75a120ad6734b0\",\"status\":\"paid\",\"amount\":10000,\"currency\":\"usd\",\"arrival_date\":1724742971,\"method\":\"standard\",\"type\":\"bank_account\"}","timestamp":"2024-08-26 15:16:11"}
{"level":"info","message":"Connected to MongoDB: mongodb://localhost:27017/cashdaddy_user_dev","timestamp":"2024-08-26 15:17:07"}
{"level":"info","message":"Connected to Redis: redis://localhost:6379","timestamp":"2024-08-26 15:17:07"}
{"level":"info","message":"Connected to Kafka: localhost:29092","timestamp":"2024-08-26 15:17:07"}
{"level":"info","message":"CacheManager initialized with CacheService.","timestamp":"2024-08-26 15:17:07"}
{"level":"info","message":"Connected Kafka Consumer","timestamp":"2024-08-26 15:17:07"}
{"level":"info","message":"Payment microservice listening on port 3003","timestamp":"2024-08-26 15:17:31"}
{"level":"info","message":"Received message:","offset":"21","partition":0,"timestamp":"2024-08-26 15:17:35","topic":"payment-events","value":"{\"action\":\"createPayout\",\"payload\":{\"customerId\":\"cus_Qj8uGWvXpd7d0p\",\"amount\":100}}"}
{"level":"info","message":"Handling createPayout event for customer: cus_Qj8uGWvXpd7d0p","timestamp":"2024-08-26 15:17:35"}
{"level":"info","message":"Simulated payout for customer cus_Qj8uGWvXpd7d0p: {\"id\":\"po_simulated_1da3c8fa774d4cac0e88eedc374082ea\",\"status\":\"paid\",\"amount\":10000,\"currency\":\"usd\",\"arrival_date\":1724743056,\"method\":\"standard\",\"type\":\"bank_account\"}","timestamp":"2024-08-26 15:17:36"}
{"level":"info","message":"Received message:","offset":"22","partition":0,"timestamp":"2024-08-26 15:17:46","topic":"payment-events","value":"{\"action\":\"returnData\",\"payload\":{\"_id\":\"66cb33624864f12a5b94bacd\",\"user\":\"66c94fd65cb63642498b6445\",\"balance\":1840,\"currency\":\"USD\",\"stripeCustomerId\":\"cus_Qj8uGWvXpd7d0p\",\"createdAt\":\"2024-08-25T13:36:34.181Z\",\"updatedAt\":\"2024-08-26T07:17:36.407Z\"}}"}
{"level":"info","message":"Cacheable decorator: caching method getPaymentMethods with key payment-method:66c94fd65cb63642498b6445","timestamp":"2024-08-26 15:17:46"}
{"level":"info","message":"Attempting to cache method with key: payment-method:66c94fd65cb63642498b6445","timestamp":"2024-08-26 15:17:46"}
{"level":"info","message":"Cache hit: payment-method:66c94fd65cb63642498b6445","timestamp":"2024-08-26 15:17:46"}
{"level":"info","message":"Response: 200 Payment methods retrieved successfully","timestamp":"2024-08-26 15:17:46"}
{"level":"info","message":"Connected to MongoDB: mongodb://localhost:27017/cashdaddy_user_dev","timestamp":"2024-08-26 15:19:30"}
{"level":"info","message":"Connected to Redis: redis://localhost:6379","timestamp":"2024-08-26 15:19:30"}
{"level":"info","message":"Connected to Kafka: localhost:29092","timestamp":"2024-08-26 15:19:30"}
{"level":"info","message":"CacheManager initialized with CacheService.","timestamp":"2024-08-26 15:19:30"}
{"level":"info","message":"Connected Kafka Consumer","timestamp":"2024-08-26 15:19:30"}
{"level":"info","message":"Payment microservice listening on port 3003","timestamp":"2024-08-26 15:19:33"}
{"level":"info","message":"Received createPaymentMethod request for user 66c94fd65cb63642498b6445","timestamp":"2024-08-26 15:19:38"}
{"level":"info","message":"Received message:","offset":"23","partition":0,"timestamp":"2024-08-26 15:19:38","topic":"payment-events","value":"{\"action\":\"returnData\",\"payload\":{\"_id\":\"66cb33624864f12a5b94bacd\",\"user\":\"66c94fd65cb63642498b6445\",\"balance\":1840,\"currency\":\"USD\",\"stripeCustomerId\":\"cus_Qj8uGWvXpd7d0p\",\"createdAt\":\"2024-08-25T13:36:34.181Z\",\"updatedAt\":\"2024-08-26T07:17:36.407Z\"}}"}
{"level":"info","message":"Payment method pm_card_visa attached to customer cus_Qj8uGWvXpd7d0p","timestamp":"2024-08-26 15:19:39"}
{"level":"info","message":"Payment method pm_1PrxDE00AhGMCNqgL0ykxmgq is already attached to customer cus_Qj8uGWvXpd7d0p","timestamp":"2024-08-26 15:19:40"}
{"level":"info","message":"Created payment method for user 66c94fd65cb63642498b6445: pm_1PrxDE00AhGMCNqgL0ykxmgq","timestamp":"2024-08-26 15:19:40"}
{"level":"info","message":"Invalidating cache with key: payment-method:66c94fd65cb63642498b6445:pm_1PrxDE00AhGMCNqgL0ykxmgq:pm_card_visa","timestamp":"2024-08-26 15:19:40"}
{"level":"info","message":"Response: 200 Payment method created successfully","timestamp":"2024-08-26 15:19:40"}
{"level":"info","message":"Received message:","offset":"24","partition":0,"timestamp":"2024-08-26 15:20:04","topic":"payment-events","value":"{\"action\":\"returnData\",\"payload\":{\"_id\":\"66cb33624864f12a5b94bacd\",\"user\":\"66c94fd65cb63642498b6445\",\"balance\":1840,\"currency\":\"USD\",\"stripeCustomerId\":\"cus_Qj8uGWvXpd7d0p\",\"createdAt\":\"2024-08-25T13:36:34.181Z\",\"updatedAt\":\"2024-08-26T07:17:36.407Z\"}}"}
{"level":"info","message":"Retrieved 2 payment methods for user 66c94fd65cb63642498b6445","timestamp":"2024-08-26 15:20:05"}
{"level":"info","message":"Response: 200 Payment methods retrieved successfully","timestamp":"2024-08-26 15:20:05"}
{"level":"info","message":"Connected to MongoDB: mongodb://localhost:27017/cashdaddy_user_dev","timestamp":"2024-08-26 15:24:36"}
{"level":"info","message":"Connected to Redis: redis://localhost:6379","timestamp":"2024-08-26 15:24:36"}
{"level":"info","message":"Connected to Kafka: localhost:29092","timestamp":"2024-08-26 15:24:36"}
{"level":"info","message":"CacheManager initialized with CacheService.","timestamp":"2024-08-26 15:24:36"}
{"level":"info","message":"Connected Kafka Consumer","timestamp":"2024-08-26 15:24:36"}
{"level":"info","message":"Payment microservice listening on port 3003","timestamp":"2024-08-26 15:25:00"}
{"level":"info","message":"Received message:","offset":"25","partition":0,"timestamp":"2024-08-26 15:26:43","topic":"payment-events","value":"{\"action\":\"returnData\",\"payload\":{\"_id\":\"66cb33624864f12a5b94bacd\",\"user\":\"66c94fd65cb63642498b6445\",\"balance\":1840,\"currency\":\"USD\",\"stripeCustomerId\":\"cus_Qj8uGWvXpd7d0p\",\"createdAt\":\"2024-08-25T13:36:34.181Z\",\"updatedAt\":\"2024-08-26T07:17:36.407Z\"}}"}
{"level":"info","message":"Retrieved 2 payment methods for user 66c94fd65cb63642498b6445","timestamp":"2024-08-26 15:26:43"}
{"level":"info","message":"Response: 200 Payment methods retrieved successfully","timestamp":"2024-08-26 15:26:43"}
{"code":"resource_missing","doc_url":"https://stripe.com/docs/error-codes/resource-missing","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET,HEAD,PUT,PATCH,POST,DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"564","content-security-policy":"report-uri https://q.stripe.com/csp-report?p=v1%2Fpayment_methods%2F%3Apayment_method%2Fdetach; block-all-mixed-content; default-src 'none'; base-uri 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'","content-type":"application/json","cross-origin-opener-policy-report-only":"same-origin; report-to=\"coop\"","date":"Mon, 26 Aug 2024 07:26:51 GMT","idempotency-key":"stripe-node-retry-1126c5c6-db08-4961-82e3-47c7cee20ec6","original-request":"req_Uhhhr9kqsMMQEd","report-to":"{\"group\":\"coop\",\"max_age\":8640,\"endpoints\":[{\"url\":\"https://q.stripe.com/coop-report?s=payins-bapi-srv\"}],\"include_subdomains\":true}","reporting-endpoints":"coop=\"https://q.stripe.com/coop-report?s=payins-bapi-srv\"","request-id":"req_Uhhhr9kqsMMQEd","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2024-06-20","vary":"Origin","x-content-type-options":"nosniff","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode"},"level":"error","message":"Error detaching payment method 66cc2c8ccbadbbcb0f1c9efa:","param":"payment_method","raw":{"code":"resource_missing","doc_url":"https://stripe.com/docs/error-codes/resource-missing","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET,HEAD,PUT,PATCH,POST,DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"564","content-security-policy":"report-uri https://q.stripe.com/csp-report?p=v1%2Fpayment_methods%2F%3Apayment_method%2Fdetach; block-all-mixed-content; default-src 'none'; base-uri 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'","content-type":"application/json","cross-origin-opener-policy-report-only":"same-origin; report-to=\"coop\"","date":"Mon, 26 Aug 2024 07:26:51 GMT","idempotency-key":"stripe-node-retry-1126c5c6-db08-4961-82e3-47c7cee20ec6","original-request":"req_Uhhhr9kqsMMQEd","report-to":"{\"group\":\"coop\",\"max_age\":8640,\"endpoints\":[{\"url\":\"https://q.stripe.com/coop-report?s=payins-bapi-srv\"}],\"include_subdomains\":true}","reporting-endpoints":"coop=\"https://q.stripe.com/coop-report?s=payins-bapi-srv\"","request-id":"req_Uhhhr9kqsMMQEd","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2024-06-20","vary":"Origin","x-content-type-options":"nosniff","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode"},"message":"No such PaymentMethod: '66cc2c8ccbadbbcb0f1c9efa'; It's possible this PaymentMethod exists on one of your connected accounts, in which case you should retry this request on that connected account. Learn more at https://stripe.com/docs/connect/authentication","param":"payment_method","requestId":"req_Uhhhr9kqsMMQEd","request_log_url":"https://dashboard.stripe.com/test/logs/req_Uhhhr9kqsMMQEd?t=1724657211","statusCode":404,"type":"invalid_request_error"},"rawType":"invalid_request_error","requestId":"req_Uhhhr9kqsMMQEd","statusCode":404,"timestamp":"2024-08-26 15:26:50","type":"StripeInvalidRequestError"}
{"level":"error","message":"Error deleting payment method:","timestamp":"2024-08-26 15:26:50"}
{"level":"info","message":"Response: 500 Failed to detach payment method: No such PaymentMethod: '66cc2c8ccbadbbcb0f1c9efa'; It's possible this PaymentMethod exists on one of your connected accounts, in which case you should retry this request on that connected account. Learn more at https://stripe.com/docs/connect/authentication","timestamp":"2024-08-26 15:26:50"}
{"level":"info","message":"Detached payment method pm_1PrxDE00AhGMCNqgL0ykxmgq","timestamp":"2024-08-26 15:26:58"}
{"kind":"ObjectId","level":"error","message":"Error in deletePaymentMethod:","path":"_id","reason":{},"stringValue":"\"pm_1PrxDE00AhGMCNqgL0ykxmgq\"","timestamp":"2024-08-26 15:26:58","value":"pm_1PrxDE00AhGMCNqgL0ykxmgq","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Error deleting payment method:","path":"_id","reason":{},"stringValue":"\"pm_1PrxDE00AhGMCNqgL0ykxmgq\"","timestamp":"2024-08-26 15:26:58","value":"pm_1PrxDE00AhGMCNqgL0ykxmgq","valueType":"string"}
{"level":"info","message":"Response: 500 Cast to ObjectId failed for value \"pm_1PrxDE00AhGMCNqgL0ykxmgq\" (type string) at path \"_id\" for model \"PaymentMethod\"","timestamp":"2024-08-26 15:26:58"}
{"level":"info","message":"Connected to MongoDB: mongodb://localhost:27017/cashdaddy_user_dev","timestamp":"2024-08-26 15:27:41"}
{"level":"info","message":"Connected to Redis: redis://localhost:6379","timestamp":"2024-08-26 15:27:41"}
{"level":"info","message":"Connected to Kafka: localhost:29092","timestamp":"2024-08-26 15:27:41"}
{"level":"info","message":"CacheManager initialized with CacheService.","timestamp":"2024-08-26 15:27:41"}
{"level":"info","message":"Connected Kafka Consumer","timestamp":"2024-08-26 15:27:41"}
{"level":"info","message":"Payment microservice listening on port 3003","timestamp":"2024-08-26 15:27:44"}
{"headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET,HEAD,PUT,PATCH,POST,DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"263","content-security-policy":"report-uri https://q.stripe.com/csp-report?p=v1%2Fpayment_methods%2F%3Apayment_method%2Fdetach; block-all-mixed-content; default-src 'none'; base-uri 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'","content-type":"application/json","cross-origin-opener-policy-report-only":"same-origin; report-to=\"coop\"","date":"Mon, 26 Aug 2024 07:28:17 GMT","idempotency-key":"stripe-node-retry-a18f08f5-e363-4f0f-bc2f-1f3cf71b3b24","original-request":"req_XQ2wBgng8dcCeC","report-to":"{\"group\":\"coop\",\"max_age\":8640,\"endpoints\":[{\"url\":\"https://q.stripe.com/coop-report?s=payins-bapi-srv\"}],\"include_subdomains\":true}","reporting-endpoints":"coop=\"https://q.stripe.com/coop-report?s=payins-bapi-srv\"","request-id":"req_XQ2wBgng8dcCeC","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2024-06-20","vary":"Origin","x-content-type-options":"nosniff","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode"},"level":"error","message":"Error detaching payment method pm_1PrxDE00AhGMCNqgL0ykxmgq:","raw":{"headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET,HEAD,PUT,PATCH,POST,DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"263","content-security-policy":"report-uri https://q.stripe.com/csp-report?p=v1%2Fpayment_methods%2F%3Apayment_method%2Fdetach; block-all-mixed-content; default-src 'none'; base-uri 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'","content-type":"application/json","cross-origin-opener-policy-report-only":"same-origin; report-to=\"coop\"","date":"Mon, 26 Aug 2024 07:28:17 GMT","idempotency-key":"stripe-node-retry-a18f08f5-e363-4f0f-bc2f-1f3cf71b3b24","original-request":"req_XQ2wBgng8dcCeC","report-to":"{\"group\":\"coop\",\"max_age\":8640,\"endpoints\":[{\"url\":\"https://q.stripe.com/coop-report?s=payins-bapi-srv\"}],\"include_subdomains\":true}","reporting-endpoints":"coop=\"https://q.stripe.com/coop-report?s=payins-bapi-srv\"","request-id":"req_XQ2wBgng8dcCeC","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2024-06-20","vary":"Origin","x-content-type-options":"nosniff","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode"},"message":"The payment method you provided is not attached to a customer so detachment is impossible.","requestId":"req_XQ2wBgng8dcCeC","request_log_url":"https://dashboard.stripe.com/test/logs/req_XQ2wBgng8dcCeC?t=1724657297","statusCode":400,"type":"invalid_request_error"},"rawType":"invalid_request_error","requestId":"req_XQ2wBgng8dcCeC","statusCode":400,"timestamp":"2024-08-26 15:28:16","type":"StripeInvalidRequestError"}
{"level":"error","message":"Error deleting payment method:","timestamp":"2024-08-26 15:28:16"}
{"level":"info","message":"Response: 500 Failed to detach payment method: The payment method you provided is not attached to a customer so detachment is impossible.","timestamp":"2024-08-26 15:28:16"}
{"level":"info","message":"Received message:","offset":"26","partition":0,"timestamp":"2024-08-26 15:28:21","topic":"payment-events","value":"{\"action\":\"returnData\",\"payload\":{\"_id\":\"66cb33624864f12a5b94bacd\",\"user\":\"66c94fd65cb63642498b6445\",\"balance\":1840,\"currency\":\"USD\",\"stripeCustomerId\":\"cus_Qj8uGWvXpd7d0p\",\"createdAt\":\"2024-08-25T13:36:34.181Z\",\"updatedAt\":\"2024-08-26T07:17:36.407Z\"}}"}
{"level":"info","message":"Retrieved 2 payment methods for user 66c94fd65cb63642498b6445","timestamp":"2024-08-26 15:28:21"}
{"level":"info","message":"Response: 200 Payment methods retrieved successfully","timestamp":"2024-08-26 15:28:21"}
{"headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET,HEAD,PUT,PATCH,POST,DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"263","content-security-policy":"report-uri https://q.stripe.com/csp-report?p=v1%2Fpayment_methods%2F%3Apayment_method%2Fdetach; block-all-mixed-content; default-src 'none'; base-uri 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'","content-type":"application/json","cross-origin-opener-policy-report-only":"same-origin; report-to=\"coop\"","date":"Mon, 26 Aug 2024 07:28:34 GMT","idempotency-key":"stripe-node-retry-e4fd97f6-7cb1-4cb6-ab82-9afb5bc08fbc","original-request":"req_mGp4DDVGr9fonw","report-to":"{\"group\":\"coop\",\"max_age\":8640,\"endpoints\":[{\"url\":\"https://q.stripe.com/coop-report?s=payins-bapi-srv\"}],\"include_subdomains\":true}","reporting-endpoints":"coop=\"https://q.stripe.com/coop-report?s=payins-bapi-srv\"","request-id":"req_mGp4DDVGr9fonw","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2024-06-20","vary":"Origin","x-content-type-options":"nosniff","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode"},"level":"error","message":"Error detaching payment method pm_1PrxDE00AhGMCNqgL0ykxmgq:","raw":{"headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET,HEAD,PUT,PATCH,POST,DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"263","content-security-policy":"report-uri https://q.stripe.com/csp-report?p=v1%2Fpayment_methods%2F%3Apayment_method%2Fdetach; block-all-mixed-content; default-src 'none'; base-uri 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'","content-type":"application/json","cross-origin-opener-policy-report-only":"same-origin; report-to=\"coop\"","date":"Mon, 26 Aug 2024 07:28:34 GMT","idempotency-key":"stripe-node-retry-e4fd97f6-7cb1-4cb6-ab82-9afb5bc08fbc","original-request":"req_mGp4DDVGr9fonw","report-to":"{\"group\":\"coop\",\"max_age\":8640,\"endpoints\":[{\"url\":\"https://q.stripe.com/coop-report?s=payins-bapi-srv\"}],\"include_subdomains\":true}","reporting-endpoints":"coop=\"https://q.stripe.com/coop-report?s=payins-bapi-srv\"","request-id":"req_mGp4DDVGr9fonw","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2024-06-20","vary":"Origin","x-content-type-options":"nosniff","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode"},"message":"The payment method you provided is not attached to a customer so detachment is impossible.","requestId":"req_mGp4DDVGr9fonw","request_log_url":"https://dashboard.stripe.com/test/logs/req_mGp4DDVGr9fonw?t=1724657314","statusCode":400,"type":"invalid_request_error"},"rawType":"invalid_request_error","requestId":"req_mGp4DDVGr9fonw","statusCode":400,"timestamp":"2024-08-26 15:28:33","type":"StripeInvalidRequestError"}
{"level":"error","message":"Error deleting payment method:","timestamp":"2024-08-26 15:28:33"}
{"level":"info","message":"Response: 500 Failed to detach payment method: The payment method you provided is not attached to a customer so detachment is impossible.","timestamp":"2024-08-26 15:28:33"}
{"level":"info","message":"Received createPaymentMethod request for user 66c94fd65cb63642498b6445","timestamp":"2024-08-26 15:31:07"}
{"level":"info","message":"Received message:","offset":"27","partition":0,"timestamp":"2024-08-26 15:31:07","topic":"payment-events","value":"{\"action\":\"returnData\",\"payload\":{\"_id\":\"66cb33624864f12a5b94bacd\",\"user\":\"66c94fd65cb63642498b6445\",\"balance\":1840,\"currency\":\"USD\",\"stripeCustomerId\":\"cus_Qj8uGWvXpd7d0p\",\"createdAt\":\"2024-08-25T13:36:34.181Z\",\"updatedAt\":\"2024-08-26T07:17:36.407Z\"}}"}
{"level":"info","message":"Payment method pm_card_visa attached to customer cus_Qj8uGWvXpd7d0p","timestamp":"2024-08-26 15:31:08"}
{"level":"info","message":"Payment method pm_1PrxOK00AhGMCNqgJpQCtDu9 is already attached to customer cus_Qj8uGWvXpd7d0p","timestamp":"2024-08-26 15:31:09"}
{"level":"info","message":"Created payment method for user 66c94fd65cb63642498b6445: pm_1PrxOK00AhGMCNqgJpQCtDu9","timestamp":"2024-08-26 15:31:09"}
{"level":"info","message":"Invalidating cache with key: payment-method:66c94fd65cb63642498b6445:pm_1PrxOK00AhGMCNqgJpQCtDu9:pm_card_visa","timestamp":"2024-08-26 15:31:09"}
{"level":"info","message":"Response: 200 Payment method created successfully","timestamp":"2024-08-26 15:31:09"}
{"level":"info","message":"Received message:","offset":"28","partition":0,"timestamp":"2024-08-26 15:31:14","topic":"payment-events","value":"{\"action\":\"returnData\",\"payload\":{\"_id\":\"66cb33624864f12a5b94bacd\",\"user\":\"66c94fd65cb63642498b6445\",\"balance\":1840,\"currency\":\"USD\",\"stripeCustomerId\":\"cus_Qj8uGWvXpd7d0p\",\"createdAt\":\"2024-08-25T13:36:34.181Z\",\"updatedAt\":\"2024-08-26T07:17:36.407Z\"}}"}
{"level":"info","message":"Retrieved 1 payment methods for user 66c94fd65cb63642498b6445","timestamp":"2024-08-26 15:31:14"}
{"level":"info","message":"Response: 200 Payment methods retrieved successfully","timestamp":"2024-08-26 15:31:14"}
{"level":"info","message":"Detached payment method pm_1PrxOK00AhGMCNqgJpQCtDu9","timestamp":"2024-08-26 15:31:20"}
{"kind":"ObjectId","level":"error","message":"Error in deletePaymentMethod:","path":"_id","reason":{},"stringValue":"\"pm_1PrxOK00AhGMCNqgJpQCtDu9\"","timestamp":"2024-08-26 15:31:20","value":"pm_1PrxOK00AhGMCNqgJpQCtDu9","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Error deleting payment method:","path":"_id","reason":{},"stringValue":"\"pm_1PrxOK00AhGMCNqgJpQCtDu9\"","timestamp":"2024-08-26 15:31:20","value":"pm_1PrxOK00AhGMCNqgJpQCtDu9","valueType":"string"}
{"level":"info","message":"Response: 500 Cast to ObjectId failed for value \"pm_1PrxOK00AhGMCNqgJpQCtDu9\" (type string) at path \"_id\" for model \"PaymentMethod\"","timestamp":"2024-08-26 15:31:20"}
{"level":"info","message":"Connected to MongoDB: mongodb://localhost:27017/cashdaddy_user_dev","timestamp":"2024-08-26 15:33:17"}
{"level":"info","message":"Connected to Redis: redis://localhost:6379","timestamp":"2024-08-26 15:33:17"}
{"level":"info","message":"Connected to Kafka: localhost:29092","timestamp":"2024-08-26 15:33:17"}
{"level":"info","message":"CacheManager initialized with CacheService.","timestamp":"2024-08-26 15:33:17"}
{"level":"info","message":"Connected Kafka Consumer","timestamp":"2024-08-26 15:33:17"}
{"level":"info","message":"Payment microservice listening on port 3003","timestamp":"2024-08-26 15:33:34"}
{"level":"info","message":"Received createPaymentMethod request for user 66c94fd65cb63642498b6445","timestamp":"2024-08-26 15:34:00"}
{"level":"info","message":"Received message:","offset":"29","partition":0,"timestamp":"2024-08-26 15:34:00","topic":"payment-events","value":"{\"action\":\"returnData\",\"payload\":{\"_id\":\"66cb33624864f12a5b94bacd\",\"user\":\"66c94fd65cb63642498b6445\",\"balance\":1840,\"currency\":\"USD\",\"stripeCustomerId\":\"cus_Qj8uGWvXpd7d0p\",\"createdAt\":\"2024-08-25T13:36:34.181Z\",\"updatedAt\":\"2024-08-26T07:17:36.407Z\"}}"}
{"level":"info","message":"Payment method pm_card_visa attached to customer cus_Qj8uGWvXpd7d0p","timestamp":"2024-08-26 15:34:01"}
{"level":"info","message":"Payment method pm_1PrxR700AhGMCNqg8ASp0SqF is already attached to customer cus_Qj8uGWvXpd7d0p","timestamp":"2024-08-26 15:34:01"}
{"level":"info","message":"Created payment method for user 66c94fd65cb63642498b6445: pm_1PrxR700AhGMCNqg8ASp0SqF","timestamp":"2024-08-26 15:34:01"}
{"level":"info","message":"Invalidating cache with key: payment-method:66c94fd65cb63642498b6445:pm_1PrxR700AhGMCNqg8ASp0SqF:pm_card_visa","timestamp":"2024-08-26 15:34:01"}
{"level":"info","message":"Response: 200 Payment method created successfully","timestamp":"2024-08-26 15:34:01"}
{"level":"info","message":"Received message:","offset":"30","partition":0,"timestamp":"2024-08-26 15:34:04","topic":"payment-events","value":"{\"action\":\"returnData\",\"payload\":{\"_id\":\"66cb33624864f12a5b94bacd\",\"user\":\"66c94fd65cb63642498b6445\",\"balance\":1840,\"currency\":\"USD\",\"stripeCustomerId\":\"cus_Qj8uGWvXpd7d0p\",\"createdAt\":\"2024-08-25T13:36:34.181Z\",\"updatedAt\":\"2024-08-26T07:17:36.407Z\"}}"}
{"level":"info","message":"Retrieved 2 payment methods for user 66c94fd65cb63642498b6445","timestamp":"2024-08-26 15:34:04"}
{"level":"info","message":"Response: 200 Payment methods retrieved successfully","timestamp":"2024-08-26 15:34:04"}
{"level":"info","message":"Detached payment method pm_1PrxR700AhGMCNqg8ASp0SqF","timestamp":"2024-08-26 15:34:23"}
{"level":"info","message":"Deleted payment method for user pm_1PrxR700AhGMCNqg8ASp0SqF","timestamp":"2024-08-26 15:34:23"}
{"level":"info","message":"Invalidating cache with key: payment-method:pm_1PrxR700AhGMCNqg8ASp0SqF","timestamp":"2024-08-26 15:34:23"}
{"level":"info","message":"Response: 200 Payment method deleted successfully","timestamp":"2024-08-26 15:34:23"}
{"level":"info","message":"Received message:","offset":"31","partition":0,"timestamp":"2024-08-26 15:34:34","topic":"payment-events","value":"{\"action\":\"returnData\",\"payload\":{\"_id\":\"66cb33624864f12a5b94bacd\",\"user\":\"66c94fd65cb63642498b6445\",\"balance\":1840,\"currency\":\"USD\",\"stripeCustomerId\":\"cus_Qj8uGWvXpd7d0p\",\"createdAt\":\"2024-08-25T13:36:34.181Z\",\"updatedAt\":\"2024-08-26T07:17:36.407Z\"}}"}
{"level":"info","message":"Retrieved 0 payment methods for user 66c94fd65cb63642498b6445","timestamp":"2024-08-26 15:34:34"}
{"level":"info","message":"Response: 200 Payment methods retrieved successfully","timestamp":"2024-08-26 15:34:34"}
{"level":"info","message":"Received message:","offset":"32","partition":0,"timestamp":"2024-08-26 15:34:39","topic":"payment-events","value":"{\"action\":\"getPaymentMethod\",\"payload\":{\"userId\":\"66c94fd65cb63642498b6445\",\"paymentMethodId\":\"pm_card_mastercard\"}}"}
{"level":"info","message":"Handling getPaymentMethods event for user: 66c94fd65cb63642498b6445","timestamp":"2024-08-26 15:34:39"}
{"level":"info","message":"Received message:","offset":"33","partition":0,"timestamp":"2024-08-26 15:34:39","topic":"payment-events","value":"{\"action\":\"triggerPaymentIntentAuto\",\"payload\":{\"amount\":100000,\"currency\":\"usd\",\"customerId\":\"cus_Qj8uGWvXpd7d0p\",\"paymentMethodId\":\"pm_card_mastercard\"}}"}
{"level":"info","message":"Handling createPaymentIntent event for customer: cus_Qj8uGWvXpd7d0p","timestamp":"2024-08-26 15:34:39"}
{"level":"info","message":"Creating PaymentIntent: amount=100000, currency=usd, customerId=cus_Qj8uGWvXpd7d0p, paymentMethodId=pm_card_mastercard","timestamp":"2024-08-26 15:34:39"}
{"level":"info","message":"PaymentIntent created: {\"id\":\"pi_3PrxRl00AhGMCNqg1LK3i2J5\",\"object\":\"payment_intent\",\"amount\":100000,\"amount_capturable\":0,\"amount_details\":{\"tip\":{}},\"amount_received\":100000,\"application\":null,\"application_fee_amount\":null,\"automatic_payment_methods\":null,\"canceled_at\":null,\"cancellation_reason\":null,\"capture_method\":\"automatic_async\",\"client_secret\":\"pi_3PrxRl00AhGMCNqg1LK3i2J5_secret_7fKX3LULkHbRbMpgp5DZX9SwB\",\"confirmation_method\":\"manual\",\"created\":1724657681,\"currency\":\"usd\",\"customer\":\"cus_Qj8uGWvXpd7d0p\",\"description\":null,\"invoice\":null,\"last_payment_error\":null,\"latest_charge\":\"ch_3PrxRl00AhGMCNqg1UbBFP5i\",\"livemode\":false,\"metadata\":{},\"next_action\":null,\"on_behalf_of\":null,\"payment_method\":\"pm_1PrxRk00AhGMCNqgJHNwewPi\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"installments\":null,\"mandate_options\":null,\"network\":null,\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"processing\":null,\"receipt_email\":null,\"review\":null,\"setup_future_usage\":null,\"shipping\":null,\"source\":null,\"statement_descriptor\":null,\"statement_descriptor_suffix\":null,\"status\":\"succeeded\",\"transfer_data\":null,\"transfer_group\":null}","timestamp":"2024-08-26 15:34:40"}
{"level":"info","message":"Received message:","offset":"34","partition":0,"timestamp":"2024-08-26 15:35:03","topic":"payment-events","value":"{\"action\":\"getPaymentMethod\",\"payload\":{\"userId\":\"66c94fd65cb63642498b6445\",\"paymentMethodId\":\"pi_3PrxRl00AhGMCNqg1LK3i2J5\"}}"}
{"level":"info","message":"Handling getPaymentMethods event for user: 66c94fd65cb63642498b6445","timestamp":"2024-08-26 15:35:03"}
{"code":"resource_missing","doc_url":"https://stripe.com/docs/error-codes/resource-missing","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET,HEAD,PUT,PATCH,POST,DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"567","content-security-policy":"report-uri https://q.stripe.com/csp-report?p=v1%2Fpayment_methods%2F%3Apayment_method; block-all-mixed-content; default-src 'none'; base-uri 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'","content-type":"application/json","cross-origin-opener-policy-report-only":"same-origin; report-to=\"coop\"","date":"Mon, 26 Aug 2024 07:35:05 GMT","report-to":"{\"group\":\"coop\",\"max_age\":8640,\"endpoints\":[{\"url\":\"https://q.stripe.com/coop-report?s=payins-bapi-srv\"}],\"include_subdomains\":true}","reporting-endpoints":"coop=\"https://q.stripe.com/coop-report?s=payins-bapi-srv\"","request-id":"req_Dv0PQYOxc1fxO7","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2024-06-20","vary":"Origin","x-content-type-options":"nosniff","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode"},"level":"error","message":"Error retrieving payment method pi_3PrxRl00AhGMCNqg1LK3i2J5:","param":"payment_method","raw":{"code":"resource_missing","doc_url":"https://stripe.com/docs/error-codes/resource-missing","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET,HEAD,PUT,PATCH,POST,DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"567","content-security-policy":"report-uri https://q.stripe.com/csp-report?p=v1%2Fpayment_methods%2F%3Apayment_method; block-all-mixed-content; default-src 'none'; base-uri 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'","content-type":"application/json","cross-origin-opener-policy-report-only":"same-origin; report-to=\"coop\"","date":"Mon, 26 Aug 2024 07:35:05 GMT","report-to":"{\"group\":\"coop\",\"max_age\":8640,\"endpoints\":[{\"url\":\"https://q.stripe.com/coop-report?s=payins-bapi-srv\"}],\"include_subdomains\":true}","reporting-endpoints":"coop=\"https://q.stripe.com/coop-report?s=payins-bapi-srv\"","request-id":"req_Dv0PQYOxc1fxO7","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2024-06-20","vary":"Origin","x-content-type-options":"nosniff","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode"},"message":"No such PaymentMethod: 'pi_3PrxRl00AhGMCNqg1LK3i2J5'; It's possible this PaymentMethod exists on one of your connected accounts, in which case you should retry this request on that connected account. Learn more at https://stripe.com/docs/connect/authentication","param":"payment_method","requestId":"req_Dv0PQYOxc1fxO7","request_log_url":"https://dashboard.stripe.com/test/logs/req_Dv0PQYOxc1fxO7?t=1724657704","statusCode":404,"type":"invalid_request_error"},"rawType":"invalid_request_error","requestId":"req_Dv0PQYOxc1fxO7","statusCode":404,"timestamp":"2024-08-26 15:35:04","type":"StripeInvalidRequestError"}
{"level":"error","message":"Error processing Kafka message:","timestamp":"2024-08-26 15:35:04"}
{"level":"info","message":"Received createPaymentMethod request for user 66c94fd65cb63642498b6445","timestamp":"2024-08-26 15:35:20"}
{"level":"info","message":"Received message:","offset":"35","partition":0,"timestamp":"2024-08-26 15:35:20","topic":"payment-events","value":"{\"action\":\"returnData\",\"payload\":{\"_id\":\"66cb33624864f12a5b94bacd\",\"user\":\"66c94fd65cb63642498b6445\",\"balance\":2840,\"currency\":\"USD\",\"stripeCustomerId\":\"cus_Qj8uGWvXpd7d0p\",\"createdAt\":\"2024-08-25T13:36:34.181Z\",\"updatedAt\":\"2024-08-26T07:34:40.833Z\"}}"}
{"level":"info","message":"Payment method pm_card_visa attached to customer cus_Qj8uGWvXpd7d0p","timestamp":"2024-08-26 15:35:21"}
{"level":"info","message":"Payment method pm_1PrxSP00AhGMCNqgFqdQM0cm is already attached to customer cus_Qj8uGWvXpd7d0p","timestamp":"2024-08-26 15:35:21"}
{"level":"info","message":"Created payment method for user 66c94fd65cb63642498b6445: pm_1PrxSP00AhGMCNqgFqdQM0cm","timestamp":"2024-08-26 15:35:21"}
{"level":"info","message":"Invalidating cache with key: payment-method:66c94fd65cb63642498b6445:pm_1PrxSP00AhGMCNqgFqdQM0cm:pm_card_visa","timestamp":"2024-08-26 15:35:21"}
{"level":"info","message":"Response: 200 Payment method created successfully","timestamp":"2024-08-26 15:35:21"}
{"level":"info","message":"Received message:","offset":"36","partition":0,"timestamp":"2024-08-26 15:35:31","topic":"payment-events","value":"{\"action\":\"getPaymentMethod\",\"payload\":{\"userId\":\"66c94fd65cb63642498b6445\",\"paymentMethodId\":\"pm_1PrxSP00AhGMCNqgFqdQM0cm\"}}"}
{"level":"info","message":"Handling getPaymentMethods event for user: 66c94fd65cb63642498b6445","timestamp":"2024-08-26 15:35:31"}
{"level":"info","message":"Received message:","offset":"37","partition":0,"timestamp":"2024-08-26 15:35:31","topic":"payment-events","value":"{\"action\":\"triggerPaymentIntentAuto\",\"payload\":{\"amount\":100000,\"currency\":\"usd\",\"customerId\":\"cus_Qj8uGWvXpd7d0p\",\"paymentMethodId\":\"pm_1PrxSP00AhGMCNqgFqdQM0cm\"}}"}
{"level":"info","message":"Handling createPaymentIntent event for customer: cus_Qj8uGWvXpd7d0p","timestamp":"2024-08-26 15:35:31"}
{"level":"info","message":"Creating PaymentIntent: amount=100000, currency=usd, customerId=cus_Qj8uGWvXpd7d0p, paymentMethodId=pm_1PrxSP00AhGMCNqgFqdQM0cm","timestamp":"2024-08-26 15:35:31"}
{"level":"info","message":"PaymentIntent created: {\"id\":\"pi_3PrxSa00AhGMCNqg0e5LLQ3Q\",\"object\":\"payment_intent\",\"amount\":100000,\"amount_capturable\":0,\"amount_details\":{\"tip\":{}},\"amount_received\":100000,\"application\":null,\"application_fee_amount\":null,\"automatic_payment_methods\":null,\"canceled_at\":null,\"cancellation_reason\":null,\"capture_method\":\"automatic_async\",\"client_secret\":\"pi_3PrxSa00AhGMCNqg0e5LLQ3Q_secret_YELZpXDEl3WnOl906WzR8E2sK\",\"confirmation_method\":\"manual\",\"created\":1724657732,\"currency\":\"usd\",\"customer\":\"cus_Qj8uGWvXpd7d0p\",\"description\":null,\"invoice\":null,\"last_payment_error\":null,\"latest_charge\":\"ch_3PrxSa00AhGMCNqg0IiKS2IF\",\"livemode\":false,\"metadata\":{},\"next_action\":null,\"on_behalf_of\":null,\"payment_method\":\"pm_1PrxSP00AhGMCNqgFqdQM0cm\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"installments\":null,\"mandate_options\":null,\"network\":null,\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"processing\":null,\"receipt_email\":null,\"review\":null,\"setup_future_usage\":null,\"shipping\":null,\"source\":null,\"statement_descriptor\":null,\"statement_descriptor_suffix\":null,\"status\":\"succeeded\",\"transfer_data\":null,\"transfer_group\":null}","timestamp":"2024-08-26 15:35:32"}
{"level":"info","message":"Received message:","offset":"38","partition":0,"timestamp":"2024-08-26 15:41:33","topic":"payment-events","value":"{\"action\":\"returnData\",\"payload\":{\"_id\":\"66cb33624864f12a5b94bacd\",\"user\":\"66c94fd65cb63642498b6445\",\"balance\":3840,\"currency\":\"USD\",\"stripeCustomerId\":\"cus_Qj8uGWvXpd7d0p\",\"createdAt\":\"2024-08-25T13:36:34.181Z\",\"updatedAt\":\"2024-08-26T07:35:32.362Z\"}}"}
{"level":"info","message":"Creating PaymentIntent: amount=undefined, currency=usd, customerId=cus_Qj8uGWvXpd7d0p, paymentMethodId=undefined","timestamp":"2024-08-26 15:41:33"}
{"level":"error","message":"Error creating PaymentIntent: Missing required param: amount.","timestamp":"2024-08-26 15:41:34"}
{"code":"parameter_missing","doc_url":"https://stripe.com/docs/error-codes/parameter-missing","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET,HEAD,PUT,PATCH,POST,DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"332","content-security-policy":"report-uri https://q.stripe.com/csp-report?p=v1%2Fpayment_intents; block-all-mixed-content; default-src 'none'; base-uri 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'","content-type":"application/json","cross-origin-opener-policy-report-only":"same-origin; report-to=\"coop\"","date":"Mon, 26 Aug 2024 07:41:35 GMT","idempotency-key":"stripe-node-retry-43ca7573-18eb-46c1-bc1e-38bab42a9a03","original-request":"req_FAUV7kxCOhqk8q","report-to":"{\"group\":\"coop\",\"max_age\":8640,\"endpoints\":[{\"url\":\"https://q.stripe.com/coop-report?s=payins-bapi-srv\"}],\"include_subdomains\":true}","reporting-endpoints":"coop=\"https://q.stripe.com/coop-report?s=payins-bapi-srv\"","request-id":"req_FAUV7kxCOhqk8q","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2024-06-20","vary":"Origin","x-content-type-options":"nosniff","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode"},"level":"error","message":"Error creating payment intent:","param":"amount","raw":{"code":"parameter_missing","doc_url":"https://stripe.com/docs/error-codes/parameter-missing","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET,HEAD,PUT,PATCH,POST,DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"332","content-security-policy":"report-uri https://q.stripe.com/csp-report?p=v1%2Fpayment_intents; block-all-mixed-content; default-src 'none'; base-uri 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'","content-type":"application/json","cross-origin-opener-policy-report-only":"same-origin; report-to=\"coop\"","date":"Mon, 26 Aug 2024 07:41:35 GMT","idempotency-key":"stripe-node-retry-43ca7573-18eb-46c1-bc1e-38bab42a9a03","original-request":"req_FAUV7kxCOhqk8q","report-to":"{\"group\":\"coop\",\"max_age\":8640,\"endpoints\":[{\"url\":\"https://q.stripe.com/coop-report?s=payins-bapi-srv\"}],\"include_subdomains\":true}","reporting-endpoints":"coop=\"https://q.stripe.com/coop-report?s=payins-bapi-srv\"","request-id":"req_FAUV7kxCOhqk8q","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2024-06-20","vary":"Origin","x-content-type-options":"nosniff","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode"},"message":"Missing required param: amount.","param":"amount","requestId":"req_FAUV7kxCOhqk8q","request_log_url":"https://dashboard.stripe.com/test/logs/req_FAUV7kxCOhqk8q?t=1724658095","statusCode":400,"type":"invalid_request_error"},"rawType":"invalid_request_error","requestId":"req_FAUV7kxCOhqk8q","statusCode":400,"timestamp":"2024-08-26 15:41:34","type":"StripeInvalidRequestError"}
{"level":"info","message":"Response: 500 Missing required param: amount.","timestamp":"2024-08-26 15:41:34"}
{"level":"info","message":"Received message:","offset":"39","partition":0,"timestamp":"2024-08-26 15:43:45","topic":"payment-events","value":"{\"action\":\"returnData\",\"payload\":{\"_id\":\"66cb33624864f12a5b94bacd\",\"user\":\"66c94fd65cb63642498b6445\",\"balance\":3840,\"currency\":\"USD\",\"stripeCustomerId\":\"cus_Qj8uGWvXpd7d0p\",\"createdAt\":\"2024-08-25T13:36:34.181Z\",\"updatedAt\":\"2024-08-26T07:35:32.362Z\"}}"}
{"level":"info","message":"Creating PaymentIntent: amount=50, currency=usd, customerId=cus_Qj8uGWvXpd7d0p, paymentMethodId=undefined","timestamp":"2024-08-26 15:43:45"}
{"level":"error","message":"Error creating PaymentIntent: The parameter `off_session` cannot be passed when creating a PaymentIntent unless `confirm` is set to true.","timestamp":"2024-08-26 15:43:46"}
{"headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET,HEAD,PUT,PATCH,POST,DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"280","content-security-policy":"report-uri https://q.stripe.com/csp-report?p=v1%2Fpayment_intents; block-all-mixed-content; default-src 'none'; base-uri 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'","content-type":"application/json","cross-origin-opener-policy-report-only":"same-origin; report-to=\"coop\"","date":"Mon, 26 Aug 2024 07:43:47 GMT","idempotency-key":"stripe-node-retry-22fd2856-7ce1-4f06-a285-596fa88608b4","original-request":"req_09QaGHnFmsIqIj","report-to":"{\"group\":\"coop\",\"max_age\":8640,\"endpoints\":[{\"url\":\"https://q.stripe.com/coop-report?s=payins-bapi-srv\"}],\"include_subdomains\":true}","reporting-endpoints":"coop=\"https://q.stripe.com/coop-report?s=payins-bapi-srv\"","request-id":"req_09QaGHnFmsIqIj","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-should-retry":"false","stripe-version":"2024-06-20","vary":"Origin","x-content-type-options":"nosniff","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode"},"level":"error","message":"Error creating payment intent:","raw":{"headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET,HEAD,PUT,PATCH,POST,DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"280","content-security-policy":"report-uri https://q.stripe.com/csp-report?p=v1%2Fpayment_intents; block-all-mixed-content; default-src 'none'; base-uri 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'","content-type":"application/json","cross-origin-opener-policy-report-only":"same-origin; report-to=\"coop\"","date":"Mon, 26 Aug 2024 07:43:47 GMT","idempotency-key":"stripe-node-retry-22fd2856-7ce1-4f06-a285-596fa88608b4","original-request":"req_09QaGHnFmsIqIj","report-to":"{\"group\":\"coop\",\"max_age\":8640,\"endpoints\":[{\"url\":\"https://q.stripe.com/coop-report?s=payins-bapi-srv\"}],\"include_subdomains\":true}","reporting-endpoints":"coop=\"https://q.stripe.com/coop-report?s=payins-bapi-srv\"","request-id":"req_09QaGHnFmsIqIj","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-should-retry":"false","stripe-version":"2024-06-20","vary":"Origin","x-content-type-options":"nosniff","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode"},"message":"The parameter `off_session` cannot be passed when creating a PaymentIntent unless `confirm` is set to true.","requestId":"req_09QaGHnFmsIqIj","request_log_url":"https://dashboard.stripe.com/test/logs/req_09QaGHnFmsIqIj?t=1724658227","statusCode":400,"type":"invalid_request_error"},"rawType":"invalid_request_error","requestId":"req_09QaGHnFmsIqIj","statusCode":400,"timestamp":"2024-08-26 15:43:46","type":"StripeInvalidRequestError"}
{"level":"info","message":"Response: 500 The parameter `off_session` cannot be passed when creating a PaymentIntent unless `confirm` is set to true.","timestamp":"2024-08-26 15:43:46"}
{"level":"info","message":"Connected to MongoDB: mongodb://localhost:27017/cashdaddy_user_dev","timestamp":"2024-08-26 15:48:16"}
{"level":"info","message":"Connected to Redis: redis://localhost:6379","timestamp":"2024-08-26 15:48:16"}
{"level":"info","message":"Connected to Kafka: localhost:29092","timestamp":"2024-08-26 15:48:16"}
{"level":"info","message":"CacheManager initialized with CacheService.","timestamp":"2024-08-26 15:48:16"}
{"level":"info","message":"Connected Kafka Consumer","timestamp":"2024-08-26 15:48:16"}
{"level":"info","message":"Connected to MongoDB: mongodb://localhost:27017/cashdaddy_user_dev","timestamp":"2024-08-26 15:48:22"}
{"level":"info","message":"Connected to Redis: redis://localhost:6379","timestamp":"2024-08-26 15:48:22"}
{"level":"info","message":"Connected to Kafka: localhost:29092","timestamp":"2024-08-26 15:48:22"}
{"level":"info","message":"CacheManager initialized with CacheService.","timestamp":"2024-08-26 15:48:22"}
{"level":"info","message":"Connected Kafka Consumer","timestamp":"2024-08-26 15:48:22"}
{"level":"info","message":"Payment microservice listening on port 3003","timestamp":"2024-08-26 15:48:36"}
{"level":"info","message":"Received message:","offset":"40","partition":0,"timestamp":"2024-08-26 15:49:28","topic":"payment-events","value":"{\"action\":\"returnData\",\"payload\":{\"_id\":\"66cb33624864f12a5b94bacd\",\"user\":\"66c94fd65cb63642498b6445\",\"balance\":3840,\"currency\":\"USD\",\"stripeCustomerId\":\"cus_Qj8uGWvXpd7d0p\",\"createdAt\":\"2024-08-25T13:36:34.181Z\",\"updatedAt\":\"2024-08-26T07:35:32.362Z\"}}"}
{"level":"info","message":"Creating PaymentIntent: amount=50, currency=usd, customerId=cus_Qj8uGWvXpd7d0p, paymentMethodId=undefined","timestamp":"2024-08-26 15:49:28"}
{"level":"info","message":"PaymentIntent created: {\"id\":\"pi_3Prxg600AhGMCNqg0Iqp2Q6d\",\"object\":\"payment_intent\",\"amount\":50,\"amount_capturable\":0,\"amount_details\":{\"tip\":{}},\"amount_received\":0,\"application\":null,\"application_fee_amount\":null,\"automatic_payment_methods\":null,\"canceled_at\":null,\"cancellation_reason\":null,\"capture_method\":\"automatic_async\",\"client_secret\":\"pi_3Prxg600AhGMCNqg0Iqp2Q6d_secret_MkoIey83FukwjTsdUAFUbcGA4\",\"confirmation_method\":\"manual\",\"created\":1724658570,\"currency\":\"usd\",\"customer\":\"cus_Qj8uGWvXpd7d0p\",\"description\":null,\"invoice\":null,\"last_payment_error\":null,\"latest_charge\":null,\"livemode\":false,\"metadata\":{},\"next_action\":null,\"on_behalf_of\":null,\"payment_method\":null,\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"installments\":null,\"mandate_options\":null,\"network\":null,\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"processing\":null,\"receipt_email\":null,\"review\":null,\"setup_future_usage\":null,\"shipping\":null,\"source\":null,\"statement_descriptor\":null,\"statement_descriptor_suffix\":null,\"status\":\"requires_payment_method\",\"transfer_data\":null,\"transfer_group\":null}","timestamp":"2024-08-26 15:49:29"}
{"level":"info","message":"Response: 200 Payment intent created successfully","timestamp":"2024-08-26 15:49:29"}
{"level":"info","message":"Confirmed PaymentIntent: pi_3Prxg600AhGMCNqg0Iqp2Q6d","timestamp":"2024-08-26 15:50:04"}
{"level":"info","message":"Response: 200 Payment intent confirmed successfully","timestamp":"2024-08-26 15:50:04"}
